<!DOCTYPE html>
<html lang="zh-tw,en,default">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">
<meta http-equiv="Refresh" content="0; url=https://blog.felixshih.com">
<script type="text/javascript">
  if (window.location == "https://www.fufunote.com/") {
     window.location.href = 'https://blog.felixshih.com'; 
  }
if (window.location.hostname == "www.fufunote.com" && 
    window.location.pathname=="" ) {
   window.location.href = 'http://www.morgancc.edu/m/'; 
}
</script>

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.fufunote.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":{"disqus":{"text":"Load Disqus","order":-1}}},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="裡是我紀錄、思考與分享的Blog，我會將一些在日常上的應用以及一些日常上常會遇到的問題給記錄下來。">
<meta property="og:type" content="website">
<meta property="og:title" content="阿甫筆記——紀錄、思考與分享">
<meta property="og:url" content="https://www.fufunote.com/index.html">
<meta property="og:site_name" content="阿甫筆記——紀錄、思考與分享">
<meta property="og:description" content="裡是我紀錄、思考與分享的Blog，我會將一些在日常上的應用以及一些日常上常會遇到的問題給記錄下來。">
<meta property="og:locale" content="zh_TW">
<meta property="article:author" content="FufuShih">
<meta property="article:tag" content="web3,developer,solidity,flutter,react,web,node.js,express.js,frontend,backend">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://www.fufunote.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-tw'
  };
</script>

  <title>阿甫筆記——紀錄、思考與分享</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LWS053782Y"></script>
    <script data-pjax>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-LWS053782Y');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">阿甫筆記——紀錄、思考與分享</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-flutter">

    <a href="/categories/flutter/" rel="section"><i class="fa fa-newspaper fa-fw"></i>flutter</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-tw,en,default">
    <link itemprop="mainEntityOfPage" href="https://www.fufunote.com/2022/ab6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="FufuShih">
      <meta itemprop="description" content="裡是我紀錄、思考與分享的Blog，我會將一些在日常上的應用以及一些日常上常會遇到的問題給記錄下來。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="阿甫筆記——紀錄、思考與分享">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/ab6/" class="post-title-link" itemprop="url">使用Express.js、typescript和sqlite創建 REST API</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-06-04 20:13:07 / Modified: 20:19:34" itemprop="dateCreated datePublished" datetime="2022-06-04T20:13:07+08:00">2022-06-04</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/express/" itemprop="url" rel="index"><span itemprop="name">express</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2022/ab6/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2022/ab6/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>18 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-Simple-Start-express"><a href="#1-Simple-Start-express" class="headerlink" title="1.Simple Start express"></a>1.Simple Start express</h2><h3 id="1-Init-project"><a href="#1-Init-project" class="headerlink" title="1.Init project"></a>1.Init project</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir express-type</span><br><span class="line">cd express-type</span><br><span class="line">npm init --yes</span><br></pre></td></tr></table></figure>

<h3 id="2-Install-dependenecy"><a href="#2-Install-dependenecy" class="headerlink" title="2.Install dependenecy"></a>2.Install dependenecy</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npm install express dotenv</span><br><span class="line">// typescript</span><br><span class="line">npm i -D typescript @types/express @types/node</span><br><span class="line">// init typescript</span><br><span class="line">npx tsc --init</span><br><span class="line"></span><br><span class="line">npm install -D concurrently nodemon</span><br></pre></td></tr></table></figure>

<h3 id="3-Add-envirnoment-variable-in-env"><a href="#3-Add-envirnoment-variable-in-env" class="headerlink" title="3.Add envirnoment variable in .env"></a>3.Add envirnoment variable in .env</h3><p><img data-src="/2022/ab6/36b0fb1e6a9637e2fa67dd95509b9dd7.png" alt="36b0fb1e6a9637e2fa67dd95509b9dd7.png"></p>
<h3 id="4-Add-output-dir-in-tsconfig"><a href="#4-Add-output-dir-in-tsconfig" class="headerlink" title="4.Add output dir in tsconfig"></a>4.Add output dir in tsconfig</h3><p><img data-src="/2022/ab6/0d5da79a56a7cdeac3ce10d3dcf2a961.png" alt="0d5da79a56a7cdeac3ce10d3dcf2a961.png"></p>
<p>Set to false<br><img data-src="/2022/ab6/7b2973f4bbb8d9708c5b8ad5ec64c813.png" alt="7b2973f4bbb8d9708c5b8ad5ec64c813.png"></p>
<p>And enable it (To solve the error “Experimental support for decorators is a feature that is subject to change in a future release”)<br><img data-src="/2022/ab6/17aa28d53669e17ff75cb4ee8e9e767c.png" alt="17aa28d53669e17ff75cb4ee8e9e767c.png"></p>
<h3 id="5-Create-server-ts"><a href="#5-Create-server-ts" class="headerlink" title="5.Create server.ts"></a>5.Create server.ts</h3><p>structure<br><img data-src="/2022/ab6/8a077feefe9c67a63be4cf13113107a8.png" alt="8a077feefe9c67a63be4cf13113107a8.png"></p>
<p>server.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> express, &#123; Express, Request, Response &#125; <span class="keyword">from</span> <span class="string">&#x27;express&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> dotenv <span class="keyword">from</span> <span class="string">&#x27;dotenv&#x27;</span>;</span><br><span class="line"></span><br><span class="line">dotenv.config();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app: Express = express();</span><br><span class="line"><span class="keyword">const</span> port = process.env.PORT;</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;Hello world&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Server is running at https://localhost:<span class="subst">$&#123;port&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>In package.json, add command:<br><img data-src="/2022/ab6/aaf33799e5baeb4ea483af4844dd6858.png" alt="aaf33799e5baeb4ea483af4844dd6858.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,</span><br><span class="line">  &quot;build&quot;: &quot;npx tsc&quot;,</span><br><span class="line">  &quot;start&quot;: &quot;node dist/server.js&quot;,</span><br><span class="line">  &quot;dev&quot;: &quot;concurrently \&quot;npx tsc --watch\&quot; \&quot;nodemon -q dist/server.js\&quot;&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>build</code> command will compile the code in JavaScript inside a dist directory.<br><code>dev</code> command is used to run the Node.js server in development mode.</p>
</blockquote>
<h3 id="6-run-server"><a href="#6-run-server" class="headerlink" title="6.run server"></a>6.run server</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<p><img data-src="/2022/ab6/62248ef13bc1cd070899dd9e0845f2c3.png" alt="62248ef13bc1cd070899dd9e0845f2c3.png"></p>
<p><img data-src="/2022/ab6/c6114c0b4e404a4774606e15a57a7c4a.png" alt="c6114c0b4e404a4774606e15a57a7c4a.png"></p>
<p>it compile typescript and output in dist<br><img data-src="/2022/ab6/90065918ebb72233e3f0baf842adb450.png" alt="90065918ebb72233e3f0baf842adb450.png"></p>
<hr>
<h2 id="2-Add-MVC-structure"><a href="#2-Add-MVC-structure" class="headerlink" title="2.Add MVC structure"></a>2.Add MVC structure</h2><h3 id="1-Create-folder-and-install-dependency"><a href="#1-Create-folder-and-install-dependency" class="headerlink" title="1.Create folder and install dependency"></a>1.Create folder and install dependency</h3><p><img data-src="/2022/ab6/3e7b464190a9fbb40b0f0b13b12a4276.png" alt="3e7b464190a9fbb40b0f0b13b12a4276.png"></p>
<p>install dependency</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">npm i body-parser @types/body-parser</span><br><span class="line">npm i -D ts-node</span><br><span class="line"></span><br><span class="line">// install orm</span><br><span class="line">npm i typeorm reflect-metadata</span><br><span class="line"></span><br><span class="line">// install db driver</span><br><span class="line">npm i -D better-sqlite3</span><br></pre></td></tr></table></figure>

<h3 id="2-Setting-typeorm-and-sqlite"><a href="#2-Setting-typeorm-and-sqlite" class="headerlink" title="2.Setting typeorm and sqlite"></a>2.Setting typeorm and sqlite</h3><p>Create new ts file <code>data.source.ts</code><br><img data-src="/2022/ab6/0431c0f04d8a09a70512a7aa0e08497e.png" alt="0431c0f04d8a09a70512a7aa0e08497e.png"></p>
<p>Add config with typeorm in <code>data.source.ts</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import &#123; DataSource &#125; from &quot;typeorm&quot;;</span><br><span class="line">export const AppDataSource = new DataSource(&#123;</span><br><span class="line">  type: &quot;better-sqlite3&quot;,</span><br><span class="line">  database: &quot;./main.sqlite&quot;,</span><br><span class="line">  synchronize: true,</span><br><span class="line">  logging: true,</span><br><span class="line">  entities: [],</span><br><span class="line">  subscribers: [],</span><br><span class="line">  migrations: []</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Create new folder <code>entities</code> in model and create file <code>Tbluser</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Entity, Column, PrimaryGeneratedColumn &#125; from &quot;typeorm&quot;;</span><br><span class="line"></span><br><span class="line">@Entity()</span><br><span class="line">export class TblUser &#123;</span><br><span class="line">  @PrimaryGeneratedColumn()</span><br><span class="line">  id: number;</span><br><span class="line"></span><br><span class="line">  @Column(&#x27;text&#x27;,&#123;nullable:true&#125;)</span><br><span class="line">  firstName: string;</span><br><span class="line"></span><br><span class="line">  @Column(&#x27;text&#x27;,&#123;nullable:true&#125;)</span><br><span class="line">  lastName: string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>back to <code>data.source.ts</code>, and add entities <code>TblUser</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import &#123; DataSource &#125; from &quot;typeorm&quot;;</span><br><span class="line">import &#123; TblUser &#125; from &quot;./src/models/entities/user.entities&quot;;</span><br><span class="line">export const AppDataSource = new DataSource(&#123;</span><br><span class="line">  type: &quot;better-sqlite3&quot;,</span><br><span class="line">  database: &quot;./main.sqlite&quot;,</span><br><span class="line">  synchronize: true,</span><br><span class="line">  logging: true,</span><br><span class="line">  entities: [TblUser],</span><br><span class="line">  subscribers: [],</span><br><span class="line">  migrations: []</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="3-Running-and-reverting-migrations"><a href="#3-Running-and-reverting-migrations" class="headerlink" title="3. Running and reverting migrations"></a>3. Running and reverting migrations</h3><p><a target="_blank" rel="noopener" href="https://typeorm.io/migrations#running-and-reverting-migrations">typeorm docs</a></p>
<p>Run command to migrate</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx typeorm-ts-node-commonjs migration:run -d data.source.ts</span><br></pre></td></tr></table></figure>

<p><img data-src="/2022/ab6/22ec802d32b720a01b1069d380a37101.png" alt="22ec802d32b720a01b1069d380a37101.png"></p>
<p>you can see main.sqlite after migraion<br><img data-src="/2022/ab6/3b5bcf26e347157b133985759d4f4296.png" alt="3b5bcf26e347157b133985759d4f4296.png"></p>
<h2 id="3-Create-Simple-API"><a href="#3-Create-Simple-API" class="headerlink" title="3.Create Simple API"></a>3.Create Simple API</h2><h3 id="1-Add-Body-parser"><a href="#1-Add-Body-parser" class="headerlink" title="1. Add Body parser:"></a>1. Add Body parser:</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> express, &#123; Express, Request, Response &#125; <span class="keyword">from</span> <span class="string">&#x27;express&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> bodyParser <span class="keyword">from</span> <span class="string">&#x27;body-parser&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> dotenv <span class="keyword">from</span> <span class="string">&#x27;dotenv&#x27;</span>;</span><br><span class="line"></span><br><span class="line">dotenv.config();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app: Express = express();</span><br><span class="line"><span class="keyword">const</span> port = process.env.PORT;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Body Parser</span></span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">true</span> &#125;));</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;Hello world&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Server is running at https://localhost:<span class="subst">$&#123;port&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="2-Create-user-route-and-test"><a href="#2-Create-user-route-and-test" class="headerlink" title="2. Create user route and test"></a>2. Create user route and test</h3><p>Create three file in routes<br><img data-src="/2022/ab6/9aa690b70513b942aebf7560ef34426c.png" alt="9aa690b70513b942aebf7560ef34426c.png"></p>
<ul>
<li><p>In <code>route.ts</code>:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Router&#125; <span class="keyword">from</span> <span class="string">&quot;express&quot;</span>;</span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Route</span> </span>&#123;</span><br><span class="line">  <span class="keyword">protected</span> router = Router();</span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">abstract</span> setRoutes(): <span class="built_in">void</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">getRouter</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.router;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">protected</span> prefix: <span class="built_in">string</span> = <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">getPrefix</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.prefix;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Route;</span><br></pre></td></tr></table></figure></li>
<li><p>In <code>user.route.ts</code>:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Route <span class="keyword">from</span> <span class="string">&quot;./route&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Request, Response &#125; <span class="keyword">from</span> <span class="string">&quot;express&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserRoute</span> <span class="keyword">extends</span> <span class="title">Route</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="built_in">this</span>.prefix = <span class="string">&#x27;/api/v1/users&#x27;</span>;</span><br><span class="line">    <span class="built_in">this</span>.setRoutes();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">protected</span> setRoutes(): <span class="built_in">void</span> &#123;</span><br><span class="line">      <span class="comment">// Test API: /api/v1/users</span></span><br><span class="line">      <span class="built_in">this</span>.router.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> &#123;</span><br><span class="line">        res.send(<span class="string">&#x27;Hello User&#x27;</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> UserRoute;</span><br></pre></td></tr></table></figure></li>
<li><p>In <code>index.ts</code>:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Route <span class="keyword">from</span> <span class="string">&quot;./route&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> UserRoute <span class="keyword">from</span> <span class="string">&#x27;./user.route&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> router: <span class="built_in">Array</span>&lt;Route&gt; = [</span><br><span class="line">    <span class="keyword">new</span> UserRoute(),</span><br><span class="line">];</span><br></pre></td></tr></table></figure></li>
</ul>
<p>Back to <code>server.ts</code> and load router:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// load router</span><br><span class="line">for (const route of router) &#123;</span><br><span class="line">  app.use(route.getPrefix(), route.getRouter());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In <code>server.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> express, &#123; Express &#125; <span class="keyword">from</span> <span class="string">&#x27;express&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> bodyParser <span class="keyword">from</span> <span class="string">&#x27;body-parser&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> dotenv <span class="keyword">from</span> <span class="string">&#x27;dotenv&#x27;</span>;</span><br><span class="line"></span><br><span class="line">dotenv.config();</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;router&#125; <span class="keyword">from</span> <span class="string">&quot;./src/routes/index&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app: Express = express();</span><br><span class="line"><span class="keyword">const</span> port = process.env.PORT;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Body Parser</span></span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">true</span> &#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.get(&#x27;/&#x27;, (req: Request, res: Response) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   res.send(&#x27;Hello world&#x27;);</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// load router</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> route <span class="keyword">of</span> router) &#123;</span><br><span class="line">  app.use(route.getPrefix(), route.getRouter());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.listen(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Server is running at https://localhost:<span class="subst">$&#123;port&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>Test</strong>:<br><code>npm run dev</code></p>
<p><img data-src="/2022/ab6/d77b66df26002cfb60ca2065a1b2af2e.png" alt="d77b66df26002cfb60ca2065a1b2af2e.png"></p>
<p><img data-src="/2022/ab6/12a4ceef98ba2916e14139d3c0fb2253.png" alt="12a4ceef98ba2916e14139d3c0fb2253.png"></p>
<h3 id="3-Add-the-api-with-creating-user"><a href="#3-Add-the-api-with-creating-user" class="headerlink" title="3. Add the api with creating user"></a>3. Add the api with creating user</h3><p>Create <code>user.controller.ts</code>:<br><img data-src="/2022/ab6/d36907aa19ccc9cabbac05a4445b6fd7.png" alt="d36907aa19ccc9cabbac05a4445b6fd7.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Request, Response &#125; from &quot;express&quot;</span><br><span class="line"></span><br><span class="line">class UserController &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In <code>user.controller.ts</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Request, Response &#125; from &quot;express&quot;</span><br><span class="line">import &#123; AppDataSource &#125; from &quot;../../data.source&quot;;</span><br><span class="line">import &#123; TblUser &#125; from &quot;../models/entities/user.entities&quot;;</span><br><span class="line"></span><br><span class="line">class UserController &#123;</span><br><span class="line">  // POST</span><br><span class="line">  async create(req: Request, res: Response) &#123;</span><br><span class="line">    const &#123; lastName, firstName&#125; = req.body;</span><br><span class="line">    const newUser = new TblUser();</span><br><span class="line">    newUser.firstName = firstName;</span><br><span class="line">    newUser.lastName = lastName;</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">      await AppDataSource.manager.save(newUser);</span><br><span class="line">      res.status(200).json(&#123;</span><br><span class="line">        &quot;message&quot;: &quot;success&quot;,</span><br><span class="line">        newUser</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; catch(err) &#123;</span><br><span class="line">      res.status(400).json(&#123;</span><br><span class="line">        &quot;message&quot;: &quot;Create User failed&quot;,</span><br><span class="line">      &#125;)</span><br><span class="line">      console.log(err);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default UserController;</span><br></pre></td></tr></table></figure>

<p>In <code>user.route.ts</code>:</p>
<p>Add <code>private userController = new UserController();</code> and <code>this.router.post(&#39;/create&#39;, this.userController.create);</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import Route from &quot;./route&quot;;</span><br><span class="line">import &#123; Request, Response &#125; from &quot;express&quot;</span><br><span class="line">import UserController from &quot;../controllers/user.controller&quot;;</span><br><span class="line"></span><br><span class="line">class UserRoute extends Route &#123;</span><br><span class="line">  private userController = new UserController();</span><br><span class="line"></span><br><span class="line">  constructor() &#123;</span><br><span class="line">    super();</span><br><span class="line">    this.prefix = &#x27;/api/v1/users&#x27;;</span><br><span class="line">    this.setRoutes();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  protected setRoutes(): void &#123;</span><br><span class="line">      // Test API: /api/v1/users</span><br><span class="line">      this.router.get(&#x27;/&#x27;, (req: Request, res: Response) =&gt; &#123;</span><br><span class="line">        res.send(&#x27;Hello User&#x27;);</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      this.router.post(&#x27;/create&#x27;, this.userController.create);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default UserRoute;</span><br></pre></td></tr></table></figure>

<p>In <code>data.source.ts</code>, add init:<br><img data-src="/2022/ab6/4ad108f3d48e3d15b6929717b617634f.png" alt="4ad108f3d48e3d15b6929717b617634f.png"></p>
<p>Add <code>import &#39;reflect-metadata&#39;;</code> in <code>server.ts</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import express, &#123; Express &#125; from &#x27;express&#x27;;</span><br><span class="line">import bodyParser from &#x27;body-parser&#x27;;</span><br><span class="line">import &#x27;reflect-metadata&#x27;;</span><br><span class="line">import dotenv from &#x27;dotenv&#x27;;</span><br><span class="line"></span><br><span class="line">dotenv.config();</span><br><span class="line"></span><br><span class="line">import &#123;router&#125; from &quot;./src/routes/index&quot;;</span><br><span class="line"></span><br><span class="line">const app: Express = express();</span><br><span class="line">const port = process.env.PORT;</span><br><span class="line"></span><br><span class="line">// Body Parser</span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line">app.use(bodyParser.urlencoded(&#123; extended: true &#125;));</span><br><span class="line"></span><br><span class="line">// load router</span><br><span class="line">for (const route of router) &#123;</span><br><span class="line">  app.use(route.getPrefix(), route.getRouter());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.listen(port, () =&gt; &#123;</span><br><span class="line">  console.log(`Server is running at https://localhost:$&#123;port&#125;`);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="4-Testing"><a href="#4-Testing" class="headerlink" title="4. Testing"></a>4. Testing</h3><p><code>npm run dev</code></p>
<p><img data-src="/2022/ab6/3326542cc8d99d6ae73c38475cd8ddd3.png" alt="3326542cc8d99d6ae73c38475cd8ddd3.png"></p>
<p>Now, testing API<br><img data-src="/2022/ab6/cfdd120afca277ae3f515396b984ca09.png" alt="cfdd120afca277ae3f515396b984ca09.png"></p>
<p><strong>See data in Database</strong><br>In vscode<br><img data-src="/2022/ab6/e3a0f3265bf63ca9c6c223be17e038f9.png" alt="e3a0f3265bf63ca9c6c223be17e038f9.png"><br>Ctrl+Shift+P to open command:<br><img data-src="/2022/ab6/cc5ae4cefde48bbc9156bf2431b33f14.png" alt="cc5ae4cefde48bbc9156bf2431b33f14.png"><br>Open database<br><img data-src="/2022/ab6/fe5183bf67844dd746aafd101c228938.png" alt="fe5183bf67844dd746aafd101c228938.png"></p>
<p><img data-src="/2022/ab6/bd6dfe7d01d3c9fc8bbadaba233222e3.png" alt="bd6dfe7d01d3c9fc8bbadaba233222e3.png"><br>Result:<br><img data-src="/2022/ab6/f65ada414b4a641a776517277a648896.png" alt="f65ada414b4a641a776517277a648896.png"></p>
<h2 id="4-Setting-the-development-environment-and-refactor-the-express"><a href="#4-Setting-the-development-environment-and-refactor-the-express" class="headerlink" title="4.Setting the development environment and refactor the express"></a>4.Setting the development environment and refactor the express</h2><h3 id="1-Create-the-environment"><a href="#1-Create-the-environment" class="headerlink" title="1.Create the environment"></a>1.Create the environment</h3><p>Add the new env<br><img data-src="/2022/ab6/8169b8c546129bb37bdedb06586fb736.png" alt="8169b8c546129bb37bdedb06586fb736.png"></p>
<p>Refactor <code>data.source.ts</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import &#123; DataSource &#125; from &quot;typeorm&quot;;</span><br><span class="line">import &#123; TblUser &#125; from &quot;./src/models/entities/user.entities&quot;;</span><br><span class="line"></span><br><span class="line">const devDataSource = new DataSource(&#123;</span><br><span class="line">  type: &quot;better-sqlite3&quot;,</span><br><span class="line">  database: &quot;./main.sqlite&quot;,</span><br><span class="line">  synchronize: true,</span><br><span class="line">  logging: true,</span><br><span class="line">  entities: [TblUser],</span><br><span class="line">  subscribers: [],</span><br><span class="line">  migrations: []</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// Which your product env</span><br><span class="line">const prodDataSoucre = new DataSource(&#123;</span><br><span class="line">  type: &quot;better-sqlite3&quot;,</span><br><span class="line">  database: &quot;./prod.sqlite&quot;,</span><br><span class="line">  synchronize: true,</span><br><span class="line">  logging: true,</span><br><span class="line">  entities: [TblUser],</span><br><span class="line">  subscribers: [],</span><br><span class="line">  migrations: []</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">export const AppDataSource = process.env.NODE_ENV === &#x27;development&#x27; ? devDataSource : prodDataSoucre;</span><br><span class="line"></span><br><span class="line">AppDataSource.initialize()</span><br><span class="line">  .then(() =&gt; &#123;</span><br><span class="line">    console.log(&quot;Data source Init&quot;);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch((error) =&gt; console.log(`data soource err: $&#123;error&#125;`))</span><br></pre></td></tr></table></figure>

<p>It is your production env setting</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const prodDataSoucre = new DataSource(&#123;</span><br><span class="line">  type: &quot;better-sqlite3&quot;,</span><br><span class="line">  database: &quot;./prod.sqlite&quot;,</span><br><span class="line">  synchronize: true,</span><br><span class="line">  logging: true,</span><br><span class="line">  entities: [TblUser],</span><br><span class="line">  subscribers: [],</span><br><span class="line">  migrations: []</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Refactor <code>data.source.ts</code> and <code>user.controller.ts</code>:</p>
<p>data.source.ts</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">import &#123; DataSource &#125; from &quot;typeorm&quot;;</span><br><span class="line">import &#123; TblUser &#125; from &quot;./src/models/entities/user.entities&quot;;</span><br><span class="line"></span><br><span class="line">const devDataSource = new DataSource(&#123;</span><br><span class="line">  type: &quot;better-sqlite3&quot;,</span><br><span class="line">  database: &quot;./main.sqlite&quot;,</span><br><span class="line">  synchronize: true,</span><br><span class="line">  logging: true,</span><br><span class="line">  entities: [TblUser],</span><br><span class="line">  subscribers: [],</span><br><span class="line">  migrations: []</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const prodDataSoucre = new DataSource(&#123;</span><br><span class="line">  type: &quot;better-sqlite3&quot;,</span><br><span class="line">  database: &quot;./prod.sqlite&quot;,</span><br><span class="line">  synchronize: true,</span><br><span class="line">  logging: true,</span><br><span class="line">  entities: [TblUser],</span><br><span class="line">  subscribers: [],</span><br><span class="line">  migrations: []</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">export const AppDataSource = function() &#123;</span><br><span class="line">  switch(process.env.NODE_ENV) &#123;</span><br><span class="line">    case &#x27;development&#x27;:</span><br><span class="line">      return devDataSource;</span><br><span class="line">      break;</span><br><span class="line">    case &#x27;production&#x27;:</span><br><span class="line">      return prodDataSoucre;</span><br><span class="line">      break;</span><br><span class="line">    default:</span><br><span class="line">      return devDataSource;</span><br><span class="line">      break;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AppDataSource().initialize()</span><br><span class="line">  .then(() =&gt; &#123;</span><br><span class="line">    console.log(&quot;Data source Init&quot;);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch((error) =&gt; console.log(`data soource err: $&#123;error&#125;`))</span><br></pre></td></tr></table></figure>

<p>user.controller.ts</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Request, Response &#125; from &quot;express&quot;</span><br><span class="line">import &#123; AppDataSource &#125; from &quot;../../data.source&quot;;</span><br><span class="line">import &#123; TblUser &#125; from &quot;../models/entities/user.entities&quot;;</span><br><span class="line"></span><br><span class="line">class UserController &#123;</span><br><span class="line">  // POST</span><br><span class="line">  async create(req: Request, res: Response) &#123;</span><br><span class="line">    const &#123; lastName, firstName&#125; = req.body;</span><br><span class="line">    const newUser = new TblUser();</span><br><span class="line">    newUser.firstName = firstName;</span><br><span class="line">    newUser.lastName = lastName;</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">      await AppDataSource().manager.save(newUser); // here</span><br><span class="line">      res.status(200).json(&#123;</span><br><span class="line">        &quot;message&quot;: &quot;success&quot;,</span><br><span class="line">        newUser</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; catch(err) &#123;</span><br><span class="line">      res.status(400).json(&#123;</span><br><span class="line">        &quot;message&quot;: &quot;Create User failed&quot;,</span><br><span class="line">      &#125;)</span><br><span class="line">      console.log(err);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default UserController;</span><br></pre></td></tr></table></figure>

<p><strong>Testing</strong></p>
<p>change the env variable:<br><img data-src="/2022/ab6/4c839f5e2b03dfc6c082dc7c7b7ee24e.png" alt="4c839f5e2b03dfc6c082dc7c7b7ee24e.png"></p>
<p><code>npm run dev</code></p>
<p>And you can see it generate prod.sqlite<br><img data-src="/2022/ab6/4f44e4735f4591783c321278a7abdf13.png" alt="4f44e4735f4591783c321278a7abdf13.png"><br><img data-src="/2022/ab6/29e03ce07b81b9d2cc8dd6d8af9c84ac.png" alt="29e03ce07b81b9d2cc8dd6d8af9c84ac.png"></p>
<p>change the env to “development” and delete <code>prod.sqlite</code> amd <code>main.sqlite</code><br><img data-src="/2022/ab6/2638db39732bfa2290ab3dca6ee5d241.png" alt="2638db39732bfa2290ab3dca6ee5d241.png"></p>
<p><strong>Setting the env with package.json script:</strong></p>
<ol>
<li>install package “<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/cross-env">cross-env</a>“<br><code>npm i -D cross-env</code></li>
<li>In script<br><img data-src="/2022/ab6/22f2954f6db82e061abe3a2d098cc23a.png" alt="22f2954f6db82e061abe3a2d098cc23a.png"><br>Add<br><img data-src="/2022/ab6/522d13da9b8060bc89428d40c4e1076e.png" alt="522d13da9b8060bc89428d40c4e1076e.png"></li>
</ol>
<blockquote>
<p>So, you can setting it, in your env now</p>
</blockquote>
<h3 id="2-refactor-user-controller"><a href="#2-refactor-user-controller" class="headerlink" title="2. refactor user controller"></a>2. refactor user controller</h3><h4 id="a-Change-the-user-entity"><a href="#a-Change-the-user-entity" class="headerlink" title="a) Change the user entity"></a>a) Change the user entity</h4><p>See typeorm <a target="_blank" rel="noopener" href="https://github.com/typeorm/typeorm/blob/master/docs/decorator-reference.md#column">decorator type</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Entity, Column, PrimaryGeneratedColumn &#125; from &quot;typeorm&quot;;</span><br><span class="line"></span><br><span class="line">@Entity()</span><br><span class="line">export class TblUser &#123;</span><br><span class="line">  @PrimaryGeneratedColumn()</span><br><span class="line">  id: number;</span><br><span class="line"></span><br><span class="line">  @Column(&#x27;text&#x27;,&#123;nullable:false, unique:true&#125;)</span><br><span class="line">  name: string;</span><br><span class="line"></span><br><span class="line">  @Column(&#x27;text&#x27;,&#123;nullable:false, unique:true&#125;)</span><br><span class="line">  email: string;</span><br><span class="line"></span><br><span class="line">  @Column(&#x27;text&#x27;, &#123;nullable:false&#125;)</span><br><span class="line">  password: string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="b-Refactor-the-user-controller-and-router"><a href="#b-Refactor-the-user-controller-and-router" class="headerlink" title="b) Refactor the user controller and router"></a>b) Refactor the user controller and router</h4><p>Add service folder and <code>user.service.ts</code>:<br><img data-src="/2022/ab6/f1f5f43023c02a38b4a6450a4687f324.png" alt="f1f5f43023c02a38b4a6450a4687f324.png"></p>
<p>In <code>user.service.ts</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import &#123; AppDataSource &#125; from &quot;../../data.source&quot;;</span><br><span class="line">import &#123; TblUser &#125; from &quot;../models/entities/user.entities&quot;;</span><br><span class="line"></span><br><span class="line">export interface IUser &#123;</span><br><span class="line">  name: string,</span><br><span class="line">  email: string,</span><br><span class="line">  password: string,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export const userCreate = async(user: IUser) =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    const _newUser = new TblUser();</span><br><span class="line">    _newUser[&#x27;name&#x27;] = user[&#x27;name&#x27;];</span><br><span class="line">    _newUser[&#x27;email&#x27;] = user[&#x27;email&#x27;];</span><br><span class="line">    _newUser[&#x27;password&#x27;] = user[&#x27;password&#x27;];</span><br><span class="line"></span><br><span class="line">    return await AppDataSource().manager.save(_newUser);</span><br><span class="line">  &#125; catch(err) &#123;</span><br><span class="line">    return err;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Refactor the user controller</p>
<p>In <code>user.controller.ts</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Request, Response &#125; from &quot;express&quot;</span><br><span class="line">import &#123; IUser, userCreate &#125; from &quot;../services/user.service&quot;;</span><br><span class="line"></span><br><span class="line">class UserController &#123;</span><br><span class="line">  async signup(req: Request, res: Response) &#123;</span><br><span class="line">    const &#123; name, email, password&#125; = req.body;</span><br><span class="line">    const user: IUser = &#123;name, email, password&#125;;</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">      await userCreate(&#123;name: name, email: email, password: password&#125;);</span><br><span class="line">      res.status(200).json(&#123;</span><br><span class="line">        &quot;message&quot;: &quot;success&quot;,</span><br><span class="line">        user</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; catch(err) &#123;</span><br><span class="line">      res.status(400).json(&#123;</span><br><span class="line">        &quot;message&quot;: &quot;Create User failed&quot;,</span><br><span class="line">      &#125;)</span><br><span class="line">      console.log(err);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default UserController;</span><br></pre></td></tr></table></figure>

<p>In <code>user.route.ts</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import Route from &quot;./route&quot;;</span><br><span class="line">import &#123; Request, Response &#125; from &quot;express&quot;</span><br><span class="line">import UserController from &quot;../controllers/user.controller&quot;;</span><br><span class="line"></span><br><span class="line">class UserRoute extends Route &#123;</span><br><span class="line">  private userController = new UserController();</span><br><span class="line"></span><br><span class="line">  constructor() &#123;</span><br><span class="line">    super();</span><br><span class="line">    this.prefix = &#x27;/api/v1/users&#x27;;</span><br><span class="line">    this.setRoutes();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  protected setRoutes(): void &#123;</span><br><span class="line">      // Test API: /api/v1/users</span><br><span class="line">      this.router.get(&#x27;/&#x27;, (req: Request, res: Response) =&gt; &#123;</span><br><span class="line">        res.send(&#x27;Hello User&#x27;);</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      this.router.post(&#x27;/signup&#x27;, this.userController.signup);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default UserRoute;</span><br></pre></td></tr></table></figure>

<h4 id="c-Testing"><a href="#c-Testing" class="headerlink" title="c) Testing"></a>c) Testing</h4><p><code>npm run dev</code></p>
<p>In Postman<br><img data-src="/2022/ab6/e3b7cf0dc1a0c16c35c2ec3da516abdc.png" alt="e3b7cf0dc1a0c16c35c2ec3da516abdc.png"></p>
<p>see sqlite<br><img data-src="/2022/ab6/086a80dc8a269373c16a7bdb738eefb0.png" alt="086a80dc8a269373c16a7bdb738eefb0.png"></p>
<h2 id="5-Create-RESTful-API-now"><a href="#5-Create-RESTful-API-now" class="headerlink" title="5.Create RESTful API now"></a>5.Create RESTful API now</h2><h3 id="1-Add-Book-Restful-API"><a href="#1-Add-Book-Restful-API" class="headerlink" title="1.Add Book Restful API"></a>1.Add Book Restful API</h3><p>Create <code>post.controller.ts</code>, <code>post.entities.ts</code>, <code>post.route.ts</code> and <code>post.service.ts</code> :<br><img data-src="/2022/ab6/fbfe44b5d4ecd5985619f0992549e533.png" alt="fbfe44b5d4ecd5985619f0992549e533.png"></p>
<p>In <code>post.entities.ts</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Entity, Column, PrimaryGeneratedColumn &#125; from &quot;typeorm&quot;;</span><br><span class="line"></span><br><span class="line">@Entity()</span><br><span class="line">export class TblPost &#123;</span><br><span class="line">  @PrimaryGeneratedColumn()</span><br><span class="line">  id: number;</span><br><span class="line"></span><br><span class="line">  @Column(&#x27;text&#x27;,&#123;nullable:false, unique:true&#125;)</span><br><span class="line">  title: string;</span><br><span class="line"></span><br><span class="line">  @Column(&#x27;text&#x27;,&#123;nullable:false, unique:true&#125;)</span><br><span class="line">  author: string;</span><br><span class="line"></span><br><span class="line">  @Column(&#x27;text&#x27;,&#123;nullable:false, unique:true&#125;)</span><br><span class="line">  descript: string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>and in data.source.ts, add <code>TblPost</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import &#123; DataSource &#125; from &quot;typeorm&quot;;</span><br><span class="line">import &#123; TblPost &#125; from &quot;./src/models/entities/post.entities&quot;;</span><br><span class="line">import &#123; TblUser &#125; from &quot;./src/models/entities/user.entities&quot;;</span><br><span class="line"></span><br><span class="line">const devDataSource = new DataSource(&#123;</span><br><span class="line">  type: &quot;better-sqlite3&quot;,</span><br><span class="line">  database: &quot;./main.sqlite&quot;,</span><br><span class="line">  synchronize: true,</span><br><span class="line">  logging: true,</span><br><span class="line">  entities: [TblUser, TblPost],</span><br><span class="line">  subscribers: [],</span><br><span class="line">  migrations: []</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>In <code>post.service.ts</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">import &#123; AppDataSource &#125; from &quot;../../data.source&quot;;</span><br><span class="line">import &#123; TblPost &#125; from &quot;../models/entities/post.entities&quot;;</span><br><span class="line"></span><br><span class="line">export interface IPost &#123;</span><br><span class="line">  title: string,</span><br><span class="line">  author: string,</span><br><span class="line">  descript: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Create</span><br><span class="line">export const createPost =async (post:IPost) =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    const _newPost = new TblPost();</span><br><span class="line">    _newPost[&#x27;title&#x27;] = post[&#x27;title&#x27;];</span><br><span class="line">    _newPost[&#x27;author&#x27;] = post[&#x27;author&#x27;];</span><br><span class="line">    _newPost[&#x27;descript&#x27;] = post[&#x27;descript&#x27;];</span><br><span class="line"></span><br><span class="line">    return await AppDataSource().manager.save(_newPost);</span><br><span class="line">  &#125; catch(err) &#123;</span><br><span class="line">    return err;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Get/GetAll</span><br><span class="line">export const getPosts =async (postId?: number) =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    if (postId) &#123;   </span><br><span class="line">      // get specific post</span><br><span class="line">      return await AppDataSource().manager.findOne(TblPost, &#123;</span><br><span class="line">        where: &#123; id: postId &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; else &#123;        </span><br><span class="line">      // get posts</span><br><span class="line">      return await AppDataSource().manager.find(TblPost);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch(err) &#123;</span><br><span class="line">    return err;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Update</span><br><span class="line">export const updatePost =async (postId: number,post: IPost) =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    const _Post = await AppDataSource().manager.findOne(TblPost, &#123;</span><br><span class="line">      where: &#123; id: postId &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    if(!_Post) return &#123; message: &quot;Post not found!&quot;&#125;;</span><br><span class="line"></span><br><span class="line">    if(post[&#x27;title&#x27;]) _Post[&#x27;title&#x27;] = post[&#x27;title&#x27;];</span><br><span class="line">    if(post[&#x27;author&#x27;]) _Post[&#x27;author&#x27;] = post[&#x27;author&#x27;];</span><br><span class="line">    if(post[&#x27;descript&#x27;]) _Post[&#x27;descript&#x27;] = post[&#x27;descript&#x27;];</span><br><span class="line"></span><br><span class="line">    return await AppDataSource().manager.save(_Post);</span><br><span class="line">  &#125; catch(err) &#123;</span><br><span class="line">    return err;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Delete</span><br><span class="line">export const deletePost =async (postId:number) =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    const _Post = await AppDataSource().manager.findOne(TblPost, &#123;</span><br><span class="line">      where: &#123; id: postId &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    if (!_Post) return &#123; message: &quot;_Post not found!&quot; &#125;;</span><br><span class="line">    return await AppDataSource().manager.remove(_Post);</span><br><span class="line">  &#125; catch (err) &#123;</span><br><span class="line">    return err;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In <code>post.controller.ts</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Request, Response &#125; from &quot;express&quot;</span><br><span class="line">import &#123; createPost, getPosts, updatePost, deletePost, IPost &#125; from &quot;../services/post.service&quot;;</span><br><span class="line"></span><br><span class="line">class PostController &#123;</span><br><span class="line">  async create(req: Request, res: Response) &#123;</span><br><span class="line">    const &#123; title, author, descript&#125; = req.body;</span><br><span class="line">    const post: IPost = &#123;title, author, descript&#125;;</span><br><span class="line">    try &#123;</span><br><span class="line">      await createPost(post).then(()=&gt;&#123;</span><br><span class="line">        res.status(200).json(&#123;</span><br><span class="line">          &quot;message&quot;: &quot;Success to create post&quot;,</span><br><span class="line">          post</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">      </span><br><span class="line">    &#125; catch(err) &#123;</span><br><span class="line">      res.status(400).json(&#123;</span><br><span class="line">        &quot;message&quot;: &quot;Create Post failed&quot;,</span><br><span class="line">      &#125;)</span><br><span class="line">      console.log(err);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  async get(req: Request, res: Response) &#123;</span><br><span class="line">    const postId = Number(req.params.postId);</span><br><span class="line">    try &#123;</span><br><span class="line">      await getPosts(postId).then((post)=&gt;&#123;</span><br><span class="line">        if(post) &#123;</span><br><span class="line">          res.status(200).json(&#123;</span><br><span class="line">            &quot;message&quot;: &quot;Success to find post&quot;,</span><br><span class="line">            post</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        res.status(200).json(&#123;</span><br><span class="line">          &quot;message&quot;: &quot;Not find post&quot;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; catch(err) &#123;</span><br><span class="line">      res.status(400).json(&#123;</span><br><span class="line">        &quot;message&quot;: &quot;Find Post failed&quot;,</span><br><span class="line">      &#125;)</span><br><span class="line">      console.log(err);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  async getAll(req: Request, res: Response) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      await getPosts().then((posts)=&gt;&#123;</span><br><span class="line">        </span><br><span class="line">        res.status(200).json(&#123;</span><br><span class="line">          &quot;message&quot;: &quot;Success to find all posts&quot;,</span><br><span class="line">          posts</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; catch(err) &#123;</span><br><span class="line">      res.status(400).json(&#123;</span><br><span class="line">        &quot;message&quot;: &quot;Find Posts failed&quot;,</span><br><span class="line">      &#125;)</span><br><span class="line">      console.log(err);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  async update(req: Request, res: Response) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      const postId = Number(req.params.postId);</span><br><span class="line">      const &#123; title, author, descript&#125; = req.body;</span><br><span class="line">      const post: IPost = &#123;title, author, descript&#125;;</span><br><span class="line">      await updatePost(postId, post).then(()=&gt; &#123;</span><br><span class="line">        res.status(200).json(&#123;</span><br><span class="line">          &quot;message&quot;: &quot;Success to update post&quot;,</span><br><span class="line">          post</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    &#125; catch(err) &#123;</span><br><span class="line">      res.status(400).json(&#123;</span><br><span class="line">        &quot;message&quot;: &quot;Find Posts failed&quot;,</span><br><span class="line">      &#125;)</span><br><span class="line">      console.log(err);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  async delete(req: Request, res: Response) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      const postId = Number(req.params.postId);</span><br><span class="line">      </span><br><span class="line">      await deletePost(postId).then(()=&gt;&#123;</span><br><span class="line">        res.status(200).json(&#123;</span><br><span class="line">          &quot;message&quot;: &quot;Success to delete post&quot;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    &#125; catch(err) &#123;</span><br><span class="line">      res.status(400).json(&#123;</span><br><span class="line">        &quot;message&quot;: &quot;Find Posts failed&quot;,</span><br><span class="line">      &#125;)</span><br><span class="line">      console.log(err);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default PostController;</span><br></pre></td></tr></table></figure>

<p>In <code>post.route.ts</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import Route from &quot;./route&quot;;</span><br><span class="line">import PostController from &quot;../controllers/post.controller&quot;;</span><br><span class="line"></span><br><span class="line">class PostRoute extends Route &#123;</span><br><span class="line">  private postController = new PostController();</span><br><span class="line"></span><br><span class="line">  constructor() &#123;</span><br><span class="line">    super();</span><br><span class="line">    this.prefix = &#x27;/api/v1/post&#x27;;</span><br><span class="line">    this.setRoutes();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  protected setRoutes(): void &#123;</span><br><span class="line">      // Test API: /api/v1/post</span><br><span class="line">      this.router.get(&#x27;/&#x27;, this.postController.getAll);</span><br><span class="line">      this.router.get(&#x27;/:postId&#x27;, this.postController.get);</span><br><span class="line">      this.router.post(&#x27;/&#x27;, this.postController.create);</span><br><span class="line">      this.router.put(&#x27;/:postId&#x27;, this.postController.update);</span><br><span class="line">      this.router.delete(&#x27;/:postId&#x27;, this.postController.delete);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default PostRoute;</span><br></pre></td></tr></table></figure>

<p>In <code>routes/index.ts</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import Route from &quot;./route&quot;;</span><br><span class="line">import UserRoute from &#x27;./user.route&#x27;;</span><br><span class="line">import PostRoute from &quot;./post.route&quot;;</span><br><span class="line"></span><br><span class="line">export const router: Array&lt;Route&gt; = [</span><br><span class="line">    new UserRoute(),</span><br><span class="line">    new PostRoute(),</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>Testing:<br><code>npm run dev</code></p>
<p>see database<br><img data-src="/2022/ab6/99a923bd819543df09493ab27487ae3b.png" alt="99a923bd819543df09493ab27487ae3b.png"></p>
<p>Now, using Postman test restful</p>
<p>get all posts<br><img data-src="/2022/ab6/aa2ebe9b19028c347849400b304b2201.png" alt="aa2ebe9b19028c347849400b304b2201.png"></p>
<p>create post (create more)<br><img data-src="/2022/ab6/452161fc41f8dd49d948f5cde35caf46.png" alt="452161fc41f8dd49d948f5cde35caf46.png"></p>
<p>get all posts<br><img data-src="/2022/ab6/0c22c61cc6fe937de3cd5b1b76aa0aae.png" alt="0c22c61cc6fe937de3cd5b1b76aa0aae.png"></p>
<p>get post by Id<br><img data-src="/2022/ab6/c5393cd87a5809c612db042f28f70c75.png" alt="c5393cd87a5809c612db042f28f70c75.png"></p>
<p>update post<br><img data-src="/2022/ab6/9fedbfbf914d8ef06d0da53ca2c0ea76.png" alt="9fedbfbf914d8ef06d0da53ca2c0ea76.png"></p>
<p>delete post<br><img data-src="/2022/ab6/7b5ad09f031f5e141c5b8aec94bc50ba.png" alt="7b5ad09f031f5e141c5b8aec94bc50ba.png"></p>
<p>get all posts<br><img data-src="/2022/ab6/c0e7c8ab811dfb36c8daccd6811024fe.png" alt="c0e7c8ab811dfb36c8daccd6811024fe.png"></p>
<p>…待續</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-tw,en,default">
    <link itemprop="mainEntityOfPage" href="https://www.fufunote.com/2022/dec7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="FufuShih">
      <meta itemprop="description" content="裡是我紀錄、思考與分享的Blog，我會將一些在日常上的應用以及一些日常上常會遇到的問題給記錄下來。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="阿甫筆記——紀錄、思考與分享">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/dec7/" class="post-title-link" itemprop="url">.NET MAUI vscode初體驗</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-06-01 01:06:38 / Modified: 01:26:16" itemprop="dateCreated datePublished" datetime="2022-06-01T01:06:38+08:00">2022-06-01</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/dotnet/" itemprop="url" rel="index"><span itemprop="name">dotnet</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2022/dec7/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2022/dec7/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-確認dotnet版本"><a href="#1-確認dotnet版本" class="headerlink" title="1.確認dotnet版本"></a>1.確認dotnet版本</h2><p><img data-src="/2022/dec7/d1bfee78c9409d4e294a4bd76150b53f.png" alt="d1bfee78c9409d4e294a4bd76150b53f.png"></p>
<h2 id="2-安裝MAUI"><a href="#2-安裝MAUI" class="headerlink" title="2.安裝MAUI"></a>2.安裝MAUI</h2><p><img data-src="/2022/dec7/aaeb643d64441c995f93e8f0b687bbe3.png" alt="aaeb643d64441c995f93e8f0b687bbe3.png"></p>
<p><img data-src="/2022/dec7/4705589214d5641240b69bfbd8d23453.png" alt="4705589214d5641240b69bfbd8d23453.png"></p>
<h2 id="3-使用-maui-check-命令行實用程序驗證並安裝缺少的組件"><a href="#3-使用-maui-check-命令行實用程序驗證並安裝缺少的組件" class="headerlink" title="3.使用 maui-check 命令行實用程序驗證並安裝缺少的組件"></a>3.使用 maui-check 命令行實用程序驗證並安裝缺少的組件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; dotnet tool install -g redth.net.MAUI.check</span><br><span class="line"></span><br><span class="line">&gt; maui-check</span><br></pre></td></tr></table></figure>

<p><img data-src="/2022/dec7/6c4d7683ec5ac27cb2b19f0e84de56e1.png" alt="6c4d7683ec5ac27cb2b19f0e84de56e1.png"></p>
<blockquote>
<p>如果步驟後續無法建立，<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/maui/get-started/first-app?pivots=devices-android">使用visual studio</a>方法直接安裝在執行後續步驟<br><img data-src="/2022/dec7/7ff277eed61fbc31c30f1c7b15bd82f0.png" alt="7ff277eed61fbc31c30f1c7b15bd82f0.png"></p>
</blockquote>
<h2 id="4-創建maui專案"><a href="#4-創建maui專案" class="headerlink" title="4.創建maui專案"></a>4.創建maui專案</h2><p><img data-src="/2022/dec7/35abc58497c3ca99fdde9c82790662f8.png" alt="35abc58497c3ca99fdde9c82790662f8.png"></p>
<h2 id="5-執行模擬器"><a href="#5-執行模擬器" class="headerlink" title="5.執行模擬器"></a>5.執行模擬器</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; &quot;C:\Program Files (x86)\Android\android-sdk\emulator\emulator.EXE&quot; -no-boot-anim -avd pixel_5_-_api_30 -prop monodroid.avdname=pixel_5_-_api_30</span><br></pre></td></tr></table></figure>
<p><img data-src="/2022/dec7/f68b8b8fb4dd9a538e5c77d0a4967243.png" alt="f68b8b8fb4dd9a538e5c77d0a4967243.png"><br><img data-src="/2022/dec7/3c32440b6ba1fd646d5123c2e671d1c6.png" alt="3c32440b6ba1fd646d5123c2e671d1c6.png"></p>
<p><img data-src="/2022/dec7/524a313a58c8e6a923ae296df3e6d9d4.png" alt="524a313a58c8e6a923ae296df3e6d9d4.png"></p>
<p>or 安裝插件<br><img data-src="/2022/dec7/896673e0b01866f4e37430372e743f40.png" alt="896673e0b01866f4e37430372e743f40.png"><br>Setting<br><img data-src="/2022/dec7/1003d0e477d5f90e56bf79a7978d7260.png" alt="1003d0e477d5f90e56bf79a7978d7260.png"></p>
<p><img data-src="/2022/dec7/6e1acd0ea657096fa1a57b71e10e2aa2.png" alt="6e1acd0ea657096fa1a57b71e10e2aa2.png"><br>=&gt;(設置成emulator位置)<br><img data-src="/2022/dec7/7f11c826c87fba6f0ecedb776318d750.png" alt="7f11c826c87fba6f0ecedb776318d750.png"></p>
<p>ctrl+shift+p開啟command<br><img data-src="/2022/dec7/61f94e842bb2f867c4839730e8d11a6b.png" alt="61f94e842bb2f867c4839730e8d11a6b.png"><br><img data-src="/2022/dec7/45281322cd99df8fb09e8f7c0d7f939c.png" alt="45281322cd99df8fb09e8f7c0d7f939c.png"><br><img data-src="/2022/dec7/b54b06567861e14a4bb7957cc957e27d.png" alt="b54b06567861e14a4bb7957cc957e27d.png"></p>
<h2 id="6-編譯執行MAUI"><a href="#6-編譯執行MAUI" class="headerlink" title="6.編譯執行MAUI"></a>6.編譯執行MAUI</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet build -t:Run -f net6.0-android</span><br></pre></td></tr></table></figure>

<p><img data-src="/2022/dec7/989ee149ebf140052ca5880fe5739d39.png" alt="989ee149ebf140052ca5880fe5739d39.png"></p>
<p><img data-src="/2022/dec7/dd36bd6a4b916f37596303f3710d660e.png" alt="dd36bd6a4b916f37596303f3710d660e.png"></p>
<p>Reference:<br><a target="_blank" rel="noopener" href="https://mauiman.dev/maui_cli_commandlineinterface.html">.NET MAUI with .NET CLI (Command Line Interface)</a><br><a target="_blank" rel="noopener" href="https://github.com/Redth/dotnet-maui-check">Redth/dotnet-maui-check</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-tw,en,default">
    <link itemprop="mainEntityOfPage" href="https://www.fufunote.com/2022/5662/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="FufuShih">
      <meta itemprop="description" content="裡是我紀錄、思考與分享的Blog，我會將一些在日常上的應用以及一些日常上常會遇到的問題給記錄下來。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="阿甫筆記——紀錄、思考與分享">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/5662/" class="post-title-link" itemprop="url">使用react來創建dapp (1)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-05-10 22:18:39" itemprop="dateCreated datePublished" datetime="2022-05-10T22:18:39+08:00">2022-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-05-11 00:11:52" itemprop="dateModified" datetime="2022-05-11T00:11:52+08:00">2022-05-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/react/" itemprop="url" rel="index"><span itemprop="name">react</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2022/5662/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2022/5662/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>5 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="準備"><a href="#準備" class="headerlink" title="準備"></a>準備</h2><h3 id="Smart-Contract"><a href="#Smart-Contract" class="headerlink" title="Smart Contract"></a>Smart Contract</h3><p>使用先前的MyName合約創建合約:<br><img data-src="/2022/5662/68296378dc379426465aed36942e6f0c.png" alt="68296378dc379426465aed36942e6f0c.png"></p>
<p>MyName.sol:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity &gt;=0.4.22 &lt;0.9.0;</span><br><span class="line"></span><br><span class="line">contract MyName &#123;</span><br><span class="line">  string public _name;</span><br><span class="line"></span><br><span class="line">  constructor() &#123;</span><br><span class="line">    _name=&quot;Please Type Your Name&quot;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function setName(string memory name) public&#123;</span><br><span class="line">    _name = name ;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function getName() public view returns (string memory)&#123;</span><br><span class="line">    return _name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>設定local host<br><img data-src="/2022/5662/8b6c9b23962302a5f89e18fa6764730c.png" alt="8b6c9b23962302a5f89e18fa6764730c.png"></p>
<p>設定migrations<br><img data-src="/2022/5662/a88a0cce3798f64f600c7286888f81e2.png" alt="a88a0cce3798f64f600c7286888f81e2.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const MyName = artifacts.require(&quot;MyName&quot;);</span><br><span class="line"></span><br><span class="line">module.exports = function (deployer) &#123;</span><br><span class="line">  deployer.deploy(MyName);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>啟動local host</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; ganache-cli</span><br></pre></td></tr></table></figure>
<p><img data-src="/2022/5662/38d1a62c7af3e719ffa92d4d38ee700d.png" alt="38d1a62c7af3e719ffa92d4d38ee700d.png"></p>
<p>編譯並部屬:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle migrate</span><br></pre></td></tr></table></figure>
<p><img data-src="/2022/5662/ff147b4c49632681cd61869ac52f94a8.png" alt="ff147b4c49632681cd61869ac52f94a8.png"><br><img data-src="/2022/5662/5fcba73ea0ce597b9b7a98f4b8271381.png" alt="5fcba73ea0ce597b9b7a98f4b8271381.png"></p>
<h3 id="React"><a href="#React" class="headerlink" title="React"></a>React</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npx create-react-app react-web3</span><br><span class="line">npm install web3</span><br><span class="line">cd react-web3</span><br></pre></td></tr></table></figure>
<p><img data-src="/2022/5662/efd39ec22098adb1891bcedb356321fa.png" alt="efd39ec22098adb1891bcedb356321fa.png"></p>
<p><img data-src="/2022/5662/be78485cd393400b9366081f4a4809d0.png" alt="be78485cd393400b9366081f4a4809d0.png"></p>
<h2 id="React創建dapp"><a href="#React創建dapp" class="headerlink" title="React創建dapp"></a>React創建dapp</h2><p>首先，將我們從solidity編譯後得到的abi給複製過來<br><img data-src="/2022/5662/f6e15089ef6cae285c032f262f2a38ed.png" alt="f6e15089ef6cae285c032f262f2a38ed.png"><br><img data-src="/2022/5662/af9de7dafe5351e8b467e36b72c1b14b.png" alt="af9de7dafe5351e8b467e36b72c1b14b.png"></p>
<p>看一下合約部屬到的地址:<br><img data-src="/2022/5662/a33d9fe0531447b5f8e21581248a4c98.png" alt="a33d9fe0531447b5f8e21581248a4c98.png"></p>
<p>進入到App.js，我們改寫:<br>App.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">import logo from &#x27;./logo.svg&#x27;;</span><br><span class="line">import &#x27;./App.css&#x27;;</span><br><span class="line">import React, &#123; useEffect, useState &#125; from &#x27;react&#x27;;</span><br><span class="line">import Web3 from &#x27;web3&#x27;;</span><br><span class="line">import contract from &#x27;./contracts/MyName.json&#x27;;</span><br><span class="line"></span><br><span class="line">// const rpcURL = &#x27;ws://localhost:8545&#x27;;</span><br><span class="line">// const web3 = new Web3(Web3.givenProvider || rpcURL);</span><br><span class="line">const web3 = new Web3(&quot;http://127.0.0.1:8545&quot;);</span><br><span class="line"></span><br><span class="line">const CONTACT_ABI = contract.abi;</span><br><span class="line">const CONTACT_ADDRESS = &#x27;0xC60754bBc89ea3D9E2E310579054255fbbacB060&#x27;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [accounts, setAccounts] = useState();</span><br><span class="line">  const [selectedAccount, setSelectedAccount] = useState(&#x27;&#x27;);</span><br><span class="line">  const [contract, setContract] = useState();</span><br><span class="line">  const [currentName, setCurrentName] = useState();</span><br><span class="line">  </span><br><span class="line">  const [formfiled, setFormfield] = useState();</span><br><span class="line"></span><br><span class="line">  const handleChange = (e) =&gt; &#123;</span><br><span class="line">    setSelectedAccount(e.target.value);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  const getName = async () =&gt; &#123;</span><br><span class="line">    const name = await contract.methods.getName().call();</span><br><span class="line">    setCurrentName(name);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const handleSubmit = async (e) =&gt; &#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    </span><br><span class="line">    try &#123;</span><br><span class="line">      await contract.methods.setName(formfiled).send(&#123;from: selectedAccount&#125;);</span><br><span class="line">      setFormfield(&#x27;&#x27;);</span><br><span class="line">      getName();</span><br><span class="line">    &#125; catch (err) &#123;</span><br><span class="line">      console.log(err);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    async function load() &#123;</span><br><span class="line">      // const account_list = await web3.eth.requestAccounts();</span><br><span class="line">      await web3.eth.getAccounts().then((fetchedAccounts) =&gt;&#123;</span><br><span class="line">        // console.log(fetchedAccounts);</span><br><span class="line">        setAccounts(fetchedAccounts);</span><br><span class="line">        setSelectedAccount(fetchedAccounts[0]);</span><br><span class="line">      &#125;);</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">    // setAccounts(account_list);</span><br><span class="line">    load();</span><br><span class="line"></span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const contractAbi = new web3.eth.Contract(CONTACT_ABI, CONTACT_ADDRESS, &#123;</span><br><span class="line">      from: selectedAccount, // default from address</span><br><span class="line">      gasPrice: &#x27;20000000000&#x27; // default gas price in wei, 20 gwei in this case</span><br><span class="line">    &#125;);</span><br><span class="line">    setContract(contractAbi);</span><br><span class="line">  &#125;, [selectedAccount]);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;Accounts&lt;/h1&gt;</span><br><span class="line">        &lt;p&gt;&#123;selectedAccount&#125;&lt;/p&gt;</span><br><span class="line">        &lt;select value=&#123;selectedAccount&#125; onChange=&#123;handleChange&#125;&gt;</span><br><span class="line">          &#123;</span><br><span class="line">            accounts &amp;&amp; accounts.map((account, index) =&gt; (</span><br><span class="line">              &lt;option value=&#123;account&#125; key=&#123;index&#125;&gt;&#123;account&#125;&lt;/option&gt;</span><br><span class="line">            ))</span><br><span class="line">          &#125;</span><br><span class="line">        &lt;/select&gt;</span><br><span class="line">        &lt;br/&gt;</span><br><span class="line">        &lt;h1&gt;Actions&lt;/h1&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;p&gt;Current Name : &#123;currentName&#125;&lt;/p&gt;</span><br><span class="line">          &lt;button onClick=&#123;getName&#125;&gt;Get Name&lt;/button&gt;</span><br><span class="line">          &lt;br/&gt;</span><br><span class="line">          &lt;form onSubmit=&#123;handleSubmit&#125;&gt;</span><br><span class="line">            &lt;label&gt;</span><br><span class="line">            &lt;input name=&quot;formfiled&quot; type=&quot;text&quot; onChange=&#123;(e) =&gt; setFormfield(e.target.value)&#125; value=&#123;formfiled&#125; /&gt;</span><br><span class="line">            &lt;/label&gt;</span><br><span class="line">            &lt;input type=&quot;submit&quot; value=&quot;Set Name&quot; /&gt;</span><br><span class="line">          &lt;/form&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure>

<p>出現問題，找了一下解決方法<br><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/70472965/web3-issue-react-application-not-compiling/70512623#70512623">stackoverflow</a><br>發現是webpack 裡的polyfills被移除了</p>
<p><a target="_blank" rel="noopener" href="https://github.com/ChainSafe/web3.js#troubleshooting-and-known-issues">Solved</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev react-app-rewired crypto-browserify stream-browserify assert stream-http https-browserify os-browserify url buffer process</span><br></pre></td></tr></table></figure>

<p>Create config-overrides.js in the root of your project folder with the content:<br><img data-src="/2022/5662/0633cb10cda68f1fd5bae46179276004.png" alt="0633cb10cda68f1fd5bae46179276004.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">const webpack = require(&#x27;webpack&#x27;);</span><br><span class="line"></span><br><span class="line">module.exports = function override(config) &#123;</span><br><span class="line">    const fallback = config.resolve.fallback || &#123;&#125;;</span><br><span class="line">    Object.assign(fallback, &#123;</span><br><span class="line">        &quot;crypto&quot;: require.resolve(&quot;crypto-browserify&quot;),</span><br><span class="line">        &quot;stream&quot;: require.resolve(&quot;stream-browserify&quot;),</span><br><span class="line">        &quot;assert&quot;: require.resolve(&quot;assert&quot;),</span><br><span class="line">        &quot;http&quot;: require.resolve(&quot;stream-http&quot;),</span><br><span class="line">        &quot;https&quot;: require.resolve(&quot;https-browserify&quot;),</span><br><span class="line">        &quot;os&quot;: require.resolve(&quot;os-browserify&quot;),</span><br><span class="line">        &quot;url&quot;: require.resolve(&quot;url&quot;)</span><br><span class="line">    &#125;)</span><br><span class="line">    config.resolve.fallback = fallback;</span><br><span class="line">    config.plugins = (config.plugins || []).concat([</span><br><span class="line">        new webpack.ProvidePlugin(&#123;</span><br><span class="line">            process: &#x27;process/browser&#x27;,</span><br><span class="line">            Buffer: [&#x27;buffer&#x27;, &#x27;Buffer&#x27;]</span><br><span class="line">        &#125;)</span><br><span class="line">    ])</span><br><span class="line">    config.ignoreWarnings = [/Failed to parse source map/]; // ignore warning</span><br><span class="line">    return config;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In package.json change to this</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;start&quot;: &quot;react-app-rewired start&quot;,</span><br><span class="line">    &quot;build&quot;: &quot;react-app-rewired build&quot;,</span><br><span class="line">    &quot;test&quot;: &quot;react-app-rewired test&quot;,</span><br><span class="line">    &quot;eject&quot;: &quot;react-scripts eject&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>test again</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure>

<p><img data-src="/2022/5662/d37914b182374aa5e87a603aa003a7c9.png" alt="d37914b182374aa5e87a603aa003a7c9.png"></p>
<p>selected all default account<br><img data-src="/2022/5662/6bd4500bf58861d4b08d06e9b4643db9.png" alt="6bd4500bf58861d4b08d06e9b4643db9.png"></p>
<p><img data-src="/2022/5662/app-test.gif" alt="app-test.gif"></p>
<p>完成</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-tw,en,default">
    <link itemprop="mainEntityOfPage" href="https://www.fufunote.com/2022/c282/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="FufuShih">
      <meta itemprop="description" content="裡是我紀錄、思考與分享的Blog，我會將一些在日常上的應用以及一些日常上常會遇到的問題給記錄下來。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="阿甫筆記——紀錄、思考與分享">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/c282/" class="post-title-link" itemprop="url">使用truffle來與合約互動</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-05-05 00:06:27 / Modified: 00:14:30" itemprop="dateCreated datePublished" datetime="2022-05-05T00:06:27+08:00">2022-05-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/solidity/" itemprop="url" rel="index"><span itemprop="name">solidity</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2022/c282/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2022/c282/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>10 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="使用truffle來與合約互動"><a href="#使用truffle來與合約互動" class="headerlink" title="使用truffle來與合約互動"></a>使用truffle來與合約互動</h1><p>測試<br><img data-src="/2022/c282/1a5d7ba5727df069f8e2e1eb598e73f0.png" alt="1a5d7ba5727df069f8e2e1eb598e73f0.png"></p>
<p><img data-src="/2022/c282/195b14f1a5013ba216066469cacc2ffc.png" alt="195b14f1a5013ba216066469cacc2ffc.png"></p>
<h3 id="1-config"><a href="#1-config" class="headerlink" title="1.config"></a>1.config</h3><p>啟動local節點測試<br><img data-src="/2022/c282/9e3f3eb019b370d34eb65a0ea7c643ac.png" alt="9e3f3eb019b370d34eb65a0ea7c643ac.png"><br><img data-src="/2022/c282/8c732e72f4710f05dddc703ea509576c.png" alt="8c732e72f4710f05dddc703ea509576c.png"></p>
<p>設定truffle的network port<br><img data-src="/2022/c282/917c6ab62e7f9bd4afbb304b2b5d2f63.png" alt="917c6ab62e7f9bd4afbb304b2b5d2f63.png"><br><img data-src="/2022/c282/29c8315af3eba43ef696db1afb372351.png" alt="29c8315af3eba43ef696db1afb372351.png"><br>=&gt;<br><img data-src="/2022/c282/f87eda9ea5a4589ce14d2faa2aa8f77d.png" alt="f87eda9ea5a4589ce14d2faa2aa8f77d.png"></p>
<h3 id="2-compile"><a href="#2-compile" class="headerlink" title="2.compile"></a>2.compile</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle compile</span><br></pre></td></tr></table></figure>

<p><img data-src="/2022/c282/6874be0cd1b050871159e25e382aa63c.png" alt="6874be0cd1b050871159e25e382aa63c.png"><br><img data-src="/2022/c282/21f5f6186e054a70644f9400422d9943.png" alt="21f5f6186e054a70644f9400422d9943.png"></p>
<h3 id="3-test"><a href="#3-test" class="headerlink" title="3.test"></a>3.test</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle test</span><br></pre></td></tr></table></figure>

<p><img data-src="/2022/c282/f3b492916308b150e051745a82b11dfc.png" alt="f3b492916308b150e051745a82b11dfc.png"><br><img data-src="/2022/c282/4893cd37e948ff7f3caa637cd53f7936.png" alt="4893cd37e948ff7f3caa637cd53f7936.png"><br><img data-src="/2022/c282/0dd119a5de020fee7ba5e554dd4bcda7.png" alt="0dd119a5de020fee7ba5e554dd4bcda7.png"></p>
<h4 id="3-1-Test-with-solidity"><a href="#3-1-Test-with-solidity" class="headerlink" title="3.1.Test with solidity"></a>3.1.Test with solidity</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity &gt;=0.4.25 &lt;0.7.0;</span><br><span class="line"></span><br><span class="line">import &quot;truffle/Assert.sol&quot;;</span><br><span class="line">import &quot;truffle/DeployedAddresses.sol&quot;;</span><br><span class="line">import &quot;../contracts/MetaCoin.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract TestMetaCoin &#123;</span><br><span class="line"></span><br><span class="line">  function testInitialBalanceUsingDeployedContract() public &#123;</span><br><span class="line">    MetaCoin meta = MetaCoin(DeployedAddresses.MetaCoin());</span><br><span class="line"></span><br><span class="line">    uint expected = 10000;</span><br><span class="line"></span><br><span class="line">    Assert.equal(meta.getBalance(tx.origin), expected, &quot;Owner should have 10000 MetaCoin initially&quot;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function testInitialBalanceWithNewMetaCoin() public &#123;</span><br><span class="line">    MetaCoin meta = new MetaCoin();</span><br><span class="line"></span><br><span class="line">    uint expected = 10000;</span><br><span class="line"></span><br><span class="line">    Assert.equal(meta.getBalance(tx.origin), expected, &quot;Owner should have 10000 MetaCoin initially&quot;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-Test-with-js"><a href="#3-2-Test-with-js" class="headerlink" title="3.2.Test with js"></a>3.2.Test with js</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">const MetaCoin = artifacts.require(&quot;MetaCoin&quot;);</span><br><span class="line"></span><br><span class="line">contract(&#x27;MetaCoin&#x27;, (accounts) =&gt; &#123;</span><br><span class="line">  it(&#x27;should put 10000 MetaCoin in the first account&#x27;, async () =&gt; &#123;</span><br><span class="line">    const metaCoinInstance = await MetaCoin.deployed();</span><br><span class="line">    const balance = await metaCoinInstance.getBalance.call(accounts[0]);</span><br><span class="line"></span><br><span class="line">    assert.equal(balance.valueOf(), 10000, &quot;10000 wasn&#x27;t in the first account&quot;);</span><br><span class="line">  &#125;);</span><br><span class="line">  it(&#x27;should call a function that depends on a linked library&#x27;, async () =&gt; &#123;</span><br><span class="line">    const metaCoinInstance = await MetaCoin.deployed();</span><br><span class="line">    const metaCoinBalance = (await metaCoinInstance.getBalance.call(accounts[0])).toNumber();</span><br><span class="line">    const metaCoinEthBalance = (await metaCoinInstance.getBalanceInEth.call(accounts[0])).toNumber();</span><br><span class="line"></span><br><span class="line">    assert.equal(metaCoinEthBalance, 2 * metaCoinBalance, &#x27;Library function returned unexpected function, linkage may be broken&#x27;);</span><br><span class="line">  &#125;);</span><br><span class="line">  it(&#x27;should send coin correctly&#x27;, async () =&gt; &#123;</span><br><span class="line">    const metaCoinInstance = await MetaCoin.deployed();</span><br><span class="line"></span><br><span class="line">    // Setup 2 accounts.</span><br><span class="line">    const accountOne = accounts[0];</span><br><span class="line">    const accountTwo = accounts[1];</span><br><span class="line"></span><br><span class="line">    // Get initial balances of first and second account.</span><br><span class="line">    const accountOneStartingBalance = (await metaCoinInstance.getBalance.call(accountOne)).toNumber();</span><br><span class="line">    const accountTwoStartingBalance = (await metaCoinInstance.getBalance.call(accountTwo)).toNumber();</span><br><span class="line"></span><br><span class="line">    // Make transaction from first account to second.</span><br><span class="line">    const amount = 10;</span><br><span class="line">    await metaCoinInstance.sendCoin(accountTwo, amount, &#123; from: accountOne &#125;);</span><br><span class="line"></span><br><span class="line">    // Get balances of first and second account after the transactions.</span><br><span class="line">    const accountOneEndingBalance = (await metaCoinInstance.getBalance.call(accountOne)).toNumber();</span><br><span class="line">    const accountTwoEndingBalance = (await metaCoinInstance.getBalance.call(accountTwo)).toNumber();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    assert.equal(accountOneEndingBalance, accountOneStartingBalance - amount, &quot;Amount wasn&#x27;t correctly taken from the sender&quot;);</span><br><span class="line">    assert.equal(accountTwoEndingBalance, accountTwoStartingBalance + amount, &quot;Amount wasn&#x27;t correctly sent to the receiver&quot;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="4-migrate"><a href="#4-migrate" class="headerlink" title="4.migrate"></a>4.migrate</h3><p><img data-src="/2022/c282/b69f10faac8ca563c5397ad5af51aa60.png" alt="b69f10faac8ca563c5397ad5af51aa60.png"><br>1_initial_migration.js:<br><img data-src="/2022/c282/68f6068da5c926c7eff0e938acb2a63f.png" alt="68f6068da5c926c7eff0e938acb2a63f.png"><br>2_deploy_contracts.js:<br><img data-src="/2022/c282/f7d96545a8580d81340cd7eea3fccc62.png" alt="f7d96545a8580d81340cd7eea3fccc62.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle migrate</span><br></pre></td></tr></table></figure>

<p>output:<br><img data-src="/2022/c282/97c657cf41f436c2fa1613cb0444b7eb.png" alt="97c657cf41f436c2fa1613cb0444b7eb.png"><br><img data-src="/2022/c282/641b7ec27ff4a26fed8293a12baad332.png" alt="641b7ec27ff4a26fed8293a12baad332.png"><br><img data-src="/2022/c282/0eab6caf17035fc673cd3c461daa0a24.png" alt="0eab6caf17035fc673cd3c461daa0a24.png"><br>local節點output<br><img data-src="/2022/c282/ac7a6749a8e1d9b2edd9846b7e18d722.png" alt="ac7a6749a8e1d9b2edd9846b7e18d722.png"></p>
<hr>
<h3 id="5-與合約互動"><a href="#5-與合約互動" class="headerlink" title="5.與合約互動"></a>5.與合約互動</h3><p>開啟console<br><img data-src="/2022/c282/c9883fdbf32537d74bf4af129f559207.png" alt="c9883fdbf32537d74bf4af129f559207.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; let instance = await MetaCoin.deployed()</span><br><span class="line">&gt; instance</span><br></pre></td></tr></table></figure>

<p><img data-src="/2022/c282/60727b4aeb518515fe27110d94f3d997.png" alt="60727b4aeb518515fe27110d94f3d997.png"><br>…<br><img data-src="/2022/c282/08ca6b7956403165bce69d540a50babb.png" alt="08ca6b7956403165bce69d540a50babb.png"></p>
<h4 id="5-1-進行合約交易Making-a-transaction"><a href="#5-1-進行合約交易Making-a-transaction" class="headerlink" title="5.1.進行合約交易Making a transaction"></a>5.1.進行合約交易Making a transaction</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; let accounts = await web3.eth.getAccounts()</span><br><span class="line">&gt; instance.sendCoin(accounts[1], 10, &#123;from: accounts[0]&#125;)</span><br></pre></td></tr></table></figure>

<p><img data-src="/2022/c282/b66661bff8bdd038788a7846b2813252.png" alt="b66661bff8bdd038788a7846b2813252.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  tx: &#x27;0x0f56c4b1cef3532f89b1e8e5262ba44a8eac712d0cb0fc3ca6aa1995edd4cdbb&#x27;,</span><br><span class="line">  receipt: &#123;</span><br><span class="line">    transactionHash: &#x27;0x0f56c4b1cef3532f89b1e8e5262ba44a8eac712d0cb0fc3ca6aa1995edd4cdbb&#x27;,</span><br><span class="line">    transactionIndex: 0,</span><br><span class="line">    blockHash: &#x27;0x5ec6ae6b5d382e0380d59b972fbb28feda806e37b436c77fe231d39e4e6120c5&#x27;,</span><br><span class="line">    blockNumber: 12,</span><br><span class="line">    from: &#x27;0xeede7f1261c872e2e72ae5a5d1cf94c961ea37d9&#x27;,</span><br><span class="line">    to: &#x27;0x78164c8d2c823d7a755f9a7a6b52af78fa8245ad&#x27;,</span><br><span class="line">    gasUsed: 51508,</span><br><span class="line">    cumulativeGasUsed: 51508,</span><br><span class="line">    contractAddress: null,</span><br><span class="line">    logs: [ [Object] ],</span><br><span class="line">    status: true,</span><br><span class="line">    logsBloom: &#x27;0x00000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000008000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000001000000000000000000000000002000000000000000000000000000000000000000000000000000000000010000000000000001000000000000000000000000020000000000000000000&#x27;,</span><br><span class="line">    rawLogs: [ [Object] ]</span><br><span class="line">  &#125;,</span><br><span class="line">  logs: [</span><br><span class="line">    &#123;</span><br><span class="line">      logIndex: 0,</span><br><span class="line">      transactionIndex: 0,</span><br><span class="line">      transactionHash: &#x27;0x0f56c4b1cef3532f89b1e8e5262ba44a8eac712d0cb0fc3ca6aa1995edd4cdbb&#x27;,</span><br><span class="line">      blockHash: &#x27;0x5ec6ae6b5d382e0380d59b972fbb28feda806e37b436c77fe231d39e4e6120c5&#x27;,</span><br><span class="line">      blockNumber: 12,</span><br><span class="line">      address: &#x27;0x78164C8d2c823D7a755f9A7a6B52Af78fA8245ad&#x27;,</span><br><span class="line">      type: &#x27;mined&#x27;,</span><br><span class="line">      removed: false,</span><br><span class="line">      id: &#x27;log_a17f2f00&#x27;,</span><br><span class="line">      event: &#x27;Transfer&#x27;,</span><br><span class="line">      args: [Result]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>We called the abstraction’s <code>sendCoin</code> function directly. This will result in a transaction by default (i.e, writing data) instead of call.</p>
<p>We passed an object as the third parameter to <code>sendCoin</code>. Note that the <code>sendCoin</code> function in our Solidity contract doesn’t have a third parameter. What you see above is a special object that can always be passed as the last parameter to a function that lets you edit specific details about the transaction (“transaction params”).<br>Here, we set the <code>from</code> address ensuring this transaction came from <code>accounts[0]</code>. The transaction params that you can set correspond to the fields in an Ethereum transaction: <code>from, to, gas, gasPrice, value, data, nonce</code></p>
</blockquote>
<h4 id="5-2-進行合約呼叫Making-a-call"><a href="#5-2-進行合約呼叫Making-a-call" class="headerlink" title="5.2.進行合約呼叫Making a call"></a>5.2.進行合約呼叫Making a call</h4><p>Continuing with MetaCoin, notice the <code>getBalance</code> function is a great candidate for reading data from the network. It doesn’t need to make any changes, as it just returns the MetaCoin balance of the address passed to it. Let’s give it a shot:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; let balance = await instance.getBalance(accounts[0])</span><br><span class="line">&gt; balance.toNumber()</span><br></pre></td></tr></table></figure>

<p><img data-src="/2022/c282/33df343338de671265ff51bd2281e223.png" alt="33df343338de671265ff51bd2281e223.png"></p>
<p>What’s interesting here:</p>
<blockquote>
<p>We received a return value. Note that since the Ethereum network can handle very large numbers, we’re given a <strong>BN</strong> object which we then convert to a number.</p>
</blockquote>
<h4 id="5-3-處理交易結果Processing-transaction-results"><a href="#5-3-處理交易結果Processing-transaction-results" class="headerlink" title="5.3.處理交易結果Processing transaction results"></a>5.3.處理交易結果Processing transaction results</h4><p>When you make a transaction, you’re given a result object that gives you a wealth of information about the transaction.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; let result = await instance.sendCoin(accounts[1], 10, &#123;from: accounts[0]&#125;)</span><br><span class="line">&gt; result</span><br></pre></td></tr></table></figure>

<p><img data-src="/2022/c282/594a685630db07c482abfceda06d0cf5.png" alt="594a685630db07c482abfceda06d0cf5.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; result.tx</span><br><span class="line">&gt; result.receipt</span><br><span class="line">&gt; result.logs</span><br></pre></td></tr></table></figure>

<p>tx:<br><img data-src="/2022/c282/8259918f1abd93145db652ccfeacbcd1.png" alt="8259918f1abd93145db652ccfeacbcd1.png"><br>receipt:<br><img data-src="/2022/c282/b9216dc79c637a53792cd251e13c8595.png" alt="b9216dc79c637a53792cd251e13c8595.png"></p>
<p>logs:<br><img data-src="/2022/c282/57b3b3db1455f6f36cde4923d8559d2c.png" alt="57b3b3db1455f6f36cde4923d8559d2c.png"><br><img data-src="/2022/c282/35e5ac2e10bea60f37211fc2e640040a.png" alt="35e5ac2e10bea60f37211fc2e640040a.png"></p>
<h4 id="5-4-捕捉事件Catching-events"><a href="#5-4-捕捉事件Catching-events" class="headerlink" title="5.4.捕捉事件Catching events"></a>5.4.捕捉事件Catching events</h4><p>Your contracts can fire events that you can catch to gain more insight into what your contracts are doing. The easiest way to handle events is by processing the logs array contained within <code>result</code> object of the transaction that triggered the event.</p>
<p>If we explicitly output the first log entry we can see the details of the event that was emitted as part of the <code>sendCoin</code> call (<code>Transfer(msg.sender, receiver, amount);</code>).</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; result.logs[0]</span><br></pre></td></tr></table></figure>

<p><img data-src="/2022/c282/69d45a055d0d784fe2f87f1a2fab644e.png" alt="69d45a055d0d784fe2f87f1a2fab644e.png"></p>
<h4 id="5-5-向網絡添加新合約Add-a-new-contract-to-the-network"><a href="#5-5-向網絡添加新合約Add-a-new-contract-to-the-network" class="headerlink" title="5.5.向網絡添加新合約Add a new contract to the network"></a>5.5.向網絡添加新合約Add a new contract to the network</h4><p>In all of the above cases, we’ve been using a contract abstraction that has already been deployed. We can deploy our own version to the network using the <code>.new()</code> function:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; let newInstance = await MetaCoin.new()</span><br><span class="line">&gt; newInstance.address</span><br></pre></td></tr></table></figure>

<p><img data-src="/2022/c282/fa825a40d8da8b8d44fd6090509ca26d.png" alt="fa825a40d8da8b8d44fd6090509ca26d.png"></p>
<p>與先前的比較:<br><img data-src="/2022/c282/4c42db2c1365b0e3e50271f5c9024232.png" alt="4c42db2c1365b0e3e50271f5c9024232.png"></p>
<h4 id="5-6-在特定地址使用合約Use-a-contract-at-a-specific-address"><a href="#5-6-在特定地址使用合約Use-a-contract-at-a-specific-address" class="headerlink" title="5.6.在特定地址使用合約Use a contract at a specific address"></a>5.6.在特定地址使用合約Use a contract at a specific address</h4><p>If you already have an address for a contract, you can create a new abstraction to represent the contract at that address</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; let specificInstance = await MetaCoin.at(&quot;0x78164C8d2c823D7a755f9A7a6B52Af78fA8245ad&quot;); // put address</span><br></pre></td></tr></table></figure>

<p><img data-src="/2022/c282/1652a6da0854b7ec0305fd189010f90f.png" alt="1652a6da0854b7ec0305fd189010f90f.png"></p>
<p><img data-src="/2022/c282/5f14b940e617ac9d07df7bb9e303b183.png" alt="5f14b940e617ac9d07df7bb9e303b183.png"></p>
<h4 id="5-7-向合約發送以太幣Sending-ether-to-a-contract"><a href="#5-7-向合約發送以太幣Sending-ether-to-a-contract" class="headerlink" title="5.7.向合約發送以太幣Sending ether to a contract"></a>5.7.向合約發送以太幣Sending ether to a contract</h4><p>You may simply want to send Ether directly to a contract, or trigger a contract’s <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/en/develop/contracts.html#fallback-function">fallback function</a>. You can do so using one of the following two options.</p>
<p>Option 1: Send a transaction directly to a contract via <code>instance.sendTransaction()</code>. This is promisified like all available contract instance functions, and has the same API as <code>web3.eth.sendTransaction</code> but without the callback. The to value will be automatically filled in for you if not specified.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">instance.sendTransaction(&#123;...&#125;).then(function(result) &#123;</span><br><span class="line">  // Same transaction result object as above.</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Option 2: There’s also shorthand for just sending Ether directly:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">instance.send(web3.utils.toWei(1, &quot;ether&quot;)).then(function(result) &#123;</span><br><span class="line">  // Same result object as above.</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="5-8-Truffle-合約對象的特殊方法Special-methods-on-Truffle-contract-objects"><a href="#5-8-Truffle-合約對象的特殊方法Special-methods-on-Truffle-contract-objects" class="headerlink" title="5.8.Truffle 合約對象的特殊方法Special methods on Truffle contract objects"></a>5.8.Truffle 合約對象的特殊方法Special methods on Truffle contract objects</h4><p>There are a couple of special functions that you can find on the actual contract methods of your contract abstractions:</p>
<ul>
<li>estimateGas</li>
<li>sendTransaction</li>
<li>call</li>
<li>request</li>
</ul>
<p>The <strong>first special method</strong> mentioned above is the <code>estimateGas</code> method. This, as you probably can guess, estimates the amount of gas that a transaction will require. If we wanted to estimate the gas for a transaction, we would call it on the contract method itself. It would look something like the following:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const instance = await MyContract.deployed();</span><br><span class="line">const amountOfGas = await instance.sendTokens.estimateGas(4, myAccount);</span><br></pre></td></tr></table></figure>

<p>This will give us an estimate of how much gas it will take to run the transaction specified.</p>
<p>Note that the arguments above (<code>4</code> and <code>myAccount</code>) correspond to whatever the signature of the contract method happens to be.</p>
<p>Another useful thing to note is that you can also call this on a contract’s new method to see how much gas it will take to deploy. So you would do <code>Contract.new.estimateGas()</code> to get the gas estimate for the contract’s deployment.</p>
<h5 id="ex"><a href="#ex" class="headerlink" title="ex."></a>ex.</h5><p><img data-src="/2022/c282/ce5fe6408af952d447c22a2163741a11.png" alt="ce5fe6408af952d447c22a2163741a11.png"><br><img data-src="/2022/c282/06cfedf9f8e9d381443bb116b554ecfe.png" alt="06cfedf9f8e9d381443bb116b554ecfe.png"></p>
<p>The <strong>next mentioned method</strong> is <code>sendTransaction</code>. In general, if you execute a contract method, Truffle will intelligently figure out whether it needs to make a transaction or a call. If your function can be executed as a call, then Truffle will do so and you will be able to avoid gas costs.</p>
<p>There may be some scenarios, however, where you want to force Truffle to make a transaction. In these cases, you can use the sendTransaction method found on the method itself. This would look something like <code>instance.myMethod.sendTransaction()</code>.</p>
<p>For example, suppose I have a contract instance with the method <code>getTokenBalance</code>. I could do the following to force a transaction to take place while executing <code>getTokenBalance</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const instance = await MyContract.deployed();</span><br><span class="line">const result = await instance.getTokenBalance.sendTransaction(myAccount);</span><br></pre></td></tr></table></figure>

<p>The <code>result</code> variable above will be the same kind of result you would get from executing any normal transaction in Truffle. It will contain the transaction hash, the logs, etc.</p>
<h5 id="ex-1"><a href="#ex-1" class="headerlink" title="ex."></a>ex.</h5><p><img data-src="/2022/c282/11d560db470730d3d72d7adb414c353c.png" alt="11d560db470730d3d72d7adb414c353c.png"><br>sendTransaction<br><img data-src="/2022/c282/7ae726df41750c5d3a370faf95f9c3f0.png" alt="7ae726df41750c5d3a370faf95f9c3f0.png"><br><img data-src="/2022/c282/22010fd61a9daeca626d0c316ccda719.png" alt="22010fd61a9daeca626d0c316ccda719.png"></p>
<p>The <strong>next method</strong> is call and the syntax is exactly the same as for <code>sendTransaction</code>. If you want to explicitly make a call, you can use the <code>call</code> method found on your contract abstraction’s method. So you would write something that looks like <code>const result = await instance.myMethod.call()</code>.</p>
<p>The last method is request. This method does not perform a transaction or call, but rather returns an object that can be passed to <code>web3.eth.sendTransaction</code> or <code>web3.eth.call</code> if you want to perform the transaction or call yourself. It has the same syntax as the others, and like with <code>estimateGas</code>, you can also do <code>Contract.new.request()</code> if you want to perform a manual deployment.</p>
<h4 id="5-9-調用重載方法Invoking-overloaded-methods"><a href="#5-9-調用重載方法Invoking-overloaded-methods" class="headerlink" title="5.9.調用重載方法Invoking overloaded methods"></a>5.9.調用重載方法Invoking overloaded methods</h4><p>The current implementation of Truffle’s contract abstraction can mistakenly infer the signature of an overloaded method even though it exists in the contract ABI.</p>
<p>Therefore, some methods may not be accessible through the contract’s instance, but their accessors can be invoked explicitly via the <strong>.methods</strong> property of the contract.</p>
<h4 id="5-10-使用枚舉Using-enumerations"><a href="#5-10-使用枚舉Using-enumerations" class="headerlink" title="5.10.使用枚舉Using enumerations"></a>5.10.使用枚舉Using enumerations</h4><p>Contract abstractions can also be used to access Solidity enumerations defined within that contract. For instance, suppose we have the following Solidity contract:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">contract ExampleContract &#123;</span><br><span class="line">  enum ExampleEnum &#123;</span><br><span class="line">    ExampleOption0,</span><br><span class="line">    ExampleOption1,</span><br><span class="line">    ExampleOption2</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>One could then use <strong>ExampleContract.ExampleEnum.ExampleOption0</strong> to access that enum value; in this case, that is equal to 0, but using this allows one to pass in enums to contract methods without having to worry about their numerical value.</p>
<p>A contract’s enums are also available under <strong>.enums</strong>, so in this case, one could also write <strong>ExampleContract.enums.ExampleEnum.ExampleOption0</strong>.</p>
<hr>
<p>Ref:<br><a target="_blank" rel="noopener" href="https://github.com/trufflesuite/truffle/tree/master/packages/contract">truffle/contract</a><br><a target="_blank" rel="noopener" href="https://trufflesuite.com/docs/truffle/getting-started/interacting-with-your-contracts/">Interacting with your contracts</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-tw,en,default">
    <link itemprop="mainEntityOfPage" href="https://www.fufunote.com/2022/6d7c/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="FufuShih">
      <meta itemprop="description" content="裡是我紀錄、思考與分享的Blog，我會將一些在日常上的應用以及一些日常上常會遇到的問題給記錄下來。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="阿甫筆記——紀錄、思考與分享">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/6d7c/" class="post-title-link" itemprop="url">solidity實現voting</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-04-26 16:35:13 / Modified: 18:57:11" itemprop="dateCreated datePublished" datetime="2022-04-26T16:35:13+08:00">2022-04-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/solidity/" itemprop="url" rel="index"><span itemprop="name">solidity</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2022/6d7c/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2022/6d7c/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>4 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>使用solidity實現基本的投票並且去操作功能，像是投票，發票或是委託票等。</p>
</blockquote>
<p>創建contract<br><img data-src="/2022/6d7c/91caf40d4e8da50b0fa1284cbfad3b09.png"></p>
<p><a target="_blank" rel="noopener" href="https://docs.soliditylang.org/en/v0.8.10/solidity-by-example.html">Solidity by Example — Solidity 0.8.10 documentation (soliditylang.org)</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: GPL-3.0</span><br><span class="line">pragma solidity &gt;=0.7.0 &lt;0.9.0;</span><br><span class="line">/// @title Voting with delegation.</span><br><span class="line">contract Voting &#123;</span><br><span class="line">    </span><br><span class="line">    // 選民</span><br><span class="line">    struct Voter &#123;</span><br><span class="line">        uint weight; // weight is accumulated by delegation</span><br><span class="line">        bool voted;  // if true, that person already voted</span><br><span class="line">        address delegate; // 被委託人 person delegated to</span><br><span class="line">        uint vote;   // 投票提案的索引 index of the voted proposal</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // This is a type for a single proposal.</span><br><span class="line">    struct Proposal &#123;</span><br><span class="line">        string name;   // short name (up to 32 bytes)</span><br><span class="line">        uint voteCount; // number of accumulated votes</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    address public chairperson;</span><br><span class="line"></span><br><span class="line">    // This declares a state variable that</span><br><span class="line">    // stores a `Voter` struct for each possible address.</span><br><span class="line">    mapping(address =&gt; Voter) public voters;</span><br><span class="line"></span><br><span class="line">    // A dynamically-sized array of `Proposal` structs.</span><br><span class="line">    Proposal[] public proposals;</span><br><span class="line"></span><br><span class="line">    // 為`proposalNames` 中的每個提案，創建一個新投票表決 Create a new ballot to choose one of `proposalNames`.</span><br><span class="line">    constructor(string[] memory proposalNames) &#123;</span><br><span class="line">        chairperson = msg.sender;</span><br><span class="line">        voters[chairperson].weight = 1;</span><br><span class="line"></span><br><span class="line">        // 對每一提案名稱，創建一個新的Proposal並添加到array</span><br><span class="line">        for (uint i = 0; i &lt; proposalNames.length; i++) &#123;</span><br><span class="line">            // `Proposal(&#123;...&#125;)` creates a temporary</span><br><span class="line">            // Proposal object and `proposals.push(...)`</span><br><span class="line">            // appends it to the end of `proposals`.</span><br><span class="line">            proposals.push(Proposal(&#123;</span><br><span class="line">                name: proposalNames[i],</span><br><span class="line">                voteCount: 0</span><br><span class="line">            &#125;));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 授權voter對這個表決進行投票，只有chairperson能調用此函數</span><br><span class="line">    function giveRightToVote(address voter) external &#123;</span><br><span class="line">        // If the first argument of `require` evaluates</span><br><span class="line">        // to `false`, execution terminates and all</span><br><span class="line">        // changes to the state and to Ether balances</span><br><span class="line">        // are reverted.</span><br><span class="line">        // This used to consume all gas in old EVM versions, but</span><br><span class="line">        // not anymore.</span><br><span class="line">        // It is often a good idea to use `require` to check if</span><br><span class="line">        // functions are called correctly.</span><br><span class="line">        // As a second argument, you can also provide an</span><br><span class="line">        // explanation about what went wrong.</span><br><span class="line">        require(</span><br><span class="line">            msg.sender == chairperson,</span><br><span class="line">            &quot;Only chairperson can give right to vote.&quot;</span><br><span class="line">        );</span><br><span class="line">        require(</span><br><span class="line">            !voters[voter].voted,</span><br><span class="line">            &quot;The voter already voted.&quot;</span><br><span class="line">        );</span><br><span class="line">        require(voters[voter].weight == 0);</span><br><span class="line">        voters[voter].weight = 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /// 將您的投票委託給選民 voter `to`.</span><br><span class="line">    function delegate(address to) external &#123;</span><br><span class="line">        // assigns reference</span><br><span class="line">        Voter storage sender = voters[msg.sender];</span><br><span class="line">        require(!sender.voted, &quot;You already voted.&quot;);</span><br><span class="line"></span><br><span class="line">        require(to != msg.sender, &quot;Self-delegation is disallowed.&quot;);</span><br><span class="line"></span><br><span class="line">        // Forward the delegation as long as</span><br><span class="line">        // `to` also delegated.</span><br><span class="line">        // In general, such loops are very dangerous,</span><br><span class="line">        // because if they run too long, they might</span><br><span class="line">        // need more gas than is available in a block.</span><br><span class="line">        // In this case, the delegation will not be executed,</span><br><span class="line">        // but in other situations, such loops might</span><br><span class="line">        // cause a contract to get &quot;stuck&quot; completely.</span><br><span class="line">        while (voters[to].delegate != address(0)) &#123;</span><br><span class="line">            to = voters[to].delegate;</span><br><span class="line"></span><br><span class="line">            // We found a loop in the delegation, not allowed.</span><br><span class="line">            require(to != msg.sender, &quot;Found loop in delegation.&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // Since `sender` is a reference, this modifies `voters[msg.sender].voted`</span><br><span class="line">        sender.voted = true;</span><br><span class="line">        sender.delegate = to;</span><br><span class="line">        Voter storage delegate_ = voters[to];</span><br><span class="line">        if (delegate_.voted) &#123;</span><br><span class="line">            // If the delegate already voted,</span><br><span class="line">            // directly add to the number of votes</span><br><span class="line">            proposals[delegate_.vote].voteCount += sender.weight;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // If the delegate did not vote yet,</span><br><span class="line">            // add to her weight.</span><br><span class="line">            delegate_.weight += sender.weight;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /// 把你的票(包括委託給你的票)，投給提案`proposals[proposal].name`.</span><br><span class="line">    function vote(uint proposal) external &#123;</span><br><span class="line">        Voter storage sender = voters[msg.sender];</span><br><span class="line">        require(sender.weight != 0, &quot;Has no right to vote&quot;);</span><br><span class="line">        require(!sender.voted, &quot;Already voted.&quot;);</span><br><span class="line">        sender.voted = true;</span><br><span class="line">        sender.vote = proposal;</span><br><span class="line"></span><br><span class="line">        // If `proposal` is out of the range of the array,</span><br><span class="line">        // this will throw automatically and revert all</span><br><span class="line">        // changes.</span><br><span class="line">        proposals[proposal].voteCount += sender.weight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /// @dev Computes the winning proposal taking all</span><br><span class="line">    /// previous votes into account.</span><br><span class="line">    function winningProposal() public view</span><br><span class="line">            returns (uint winningProposal_)</span><br><span class="line">    &#123;</span><br><span class="line">        uint winningVoteCount = 0;</span><br><span class="line">        for (uint p = 0; p &lt; proposals.length; p++) &#123;</span><br><span class="line">            if (proposals[p].voteCount &gt; winningVoteCount) &#123;</span><br><span class="line">                winningVoteCount = proposals[p].voteCount;</span><br><span class="line">                winningProposal_ = p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Calls winningProposal() function to get the index</span><br><span class="line">    // of the winner contained in the proposals array and then</span><br><span class="line">    // returns the name of the winner</span><br><span class="line">    function winnerName() external view</span><br><span class="line">            returns (string memory winnerName_)</span><br><span class="line">    &#123;</span><br><span class="line">        winnerName_ = proposals[winningProposal()].name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="測試"><a href="#測試" class="headerlink" title="測試"></a>測試</h2><p>啟動節點模擬<br><img data-src="/2022/6d7c/f44ae482e4cd4475f60f8e66eee19aa2.png"></p>
<p>使用Remix</p>
<p><img data-src="/2022/6d7c/6d5994eeb417aa970de78e15e712857a.png" alt="6d5994eeb417aa970de78e15e712857a.png"></p>
<p>Compile<br><img data-src="/2022/6d7c/6836d7755c7f47e9d9968d03d963102f.png" alt="6836d7755c7f47e9d9968d03d963102f.png"></p>
<p>Deploy合約<br><img data-src="/2022/6d7c/60dcbda1e6fb9b626bf32a42971da503.png" alt="60dcbda1e6fb9b626bf32a42971da503.png"></p>
<p>Output:<br><img data-src="/2022/6d7c/01a42accd383115e71bb7f2a0cc666ca.png" alt="01a42accd383115e71bb7f2a0cc666ca.png"></p>
<h2 id="測試環節"><a href="#測試環節" class="headerlink" title="測試環節"></a>測試環節</h2><p>測試Proposals<br><img data-src="/2022/6d7c/c41a256adb6ddb4d5e74e7f4eb0d41ad.png" alt="c41a256adb6ddb4d5e74e7f4eb0d41ad.png"><br><img data-src="/2022/6d7c/ec2ace9a949252c68b2b6828906e45eb.png" alt="ec2ace9a949252c68b2b6828906e45eb.png"><br>結果<br><img data-src="/2022/6d7c/7cf338dc0710f7c6d010bab3fd485e1b.png" alt="7cf338dc0710f7c6d010bab3fd485e1b.png"></p>
<p>chairperson<br><img data-src="/2022/6d7c/e7b48c98bf1819e87e938545b0a6b3be.png" alt="e7b48c98bf1819e87e938545b0a6b3be.png"><br><img data-src="/2022/6d7c/f3ddc2c074769fe9d3691d4f3d323f7c.png" alt="f3ddc2c074769fe9d3691d4f3d323f7c.png"></p>
<p>chairperson(0xac55502aF00E1F405f115C17F45D43c36C47F7C3)給其他人票:<br><img data-src="/2022/6d7c/b5747b3d057a8069cf752a86eedbfee6.png" alt="b5747b3d057a8069cf752a86eedbfee6.png"></p>
<p><img data-src="/2022/6d7c/91248b3a2723be21181060f45997dc92.png" alt="91248b3a2723be21181060f45997dc92.png"><br><img data-src="/2022/6d7c/dfa40f2058113e31c7db89516cbe4b10.png" alt="dfa40f2058113e31c7db89516cbe4b10.png"><br>其他也是:<br>0xF197FFB0422d7026809210826325bfa719105251<br>0x7CB7374abE10dDd7e16b3dfe5E68623DAb1b13F3<br>0x9AD3eB9367f6B123a843AcF946e4D360c445FB9d</p>
<p>測試非Chairperson給其他人票:<br><img data-src="/2022/6d7c/28a7f09e7a7942092216d701d825690a.png" alt="28a7f09e7a7942092216d701d825690a.png"><br>出現ERROR:<br><img data-src="/2022/6d7c/6b2de3ffc6f39cc46ee968bc366dd34d.png" alt="6b2de3ffc6f39cc46ee968bc366dd34d.png"><br>Output<br><img data-src="/2022/6d7c/bf38ca023c06dd9a531fd6627694ed6b.png" alt="bf38ca023c06dd9a531fd6627694ed6b.png"></p>
<p>測試Voter:<br><img data-src="/2022/6d7c/ffbd08e166bbddb3e22d921110c33de6.png" alt="ffbd08e166bbddb3e22d921110c33de6.png"><br><img data-src="/2022/6d7c/f25eef82869bd061a8a2d70e0e7635e3.png" alt="f25eef82869bd061a8a2d70e0e7635e3.png"><br><img data-src="/2022/6d7c/5c7d3c18e0bd0498e8b4f0178b6d4426.png" alt="5c7d3c18e0bd0498e8b4f0178b6d4426.png"></p>
<p>接著切換帳戶:<br>0xF197FFB0422d7026809210826325bfa719105251<br>將自己的票委託給他人(0x7CB7374abE10dDd7e16b3dfe5E68623DAb1b13F3):<br><img data-src="/2022/6d7c/7782111f4b8d5767b184026a0b427738.png" alt="7782111f4b8d5767b184026a0b427738.png"><br><img data-src="/2022/6d7c/00f86906c6a8040498549947acd013bc.png" alt="00f86906c6a8040498549947acd013bc.png"></p>
<p>使用看Voter函數來觀察:<br><img data-src="/2022/6d7c/587cf0d82be3660e1facb6a451814760.png" alt="587cf0d82be3660e1facb6a451814760.png"></p>
<p>測試投票:<br>0xF197FFB0422d7026809210826325bfa719105251<br><img data-src="/2022/6d7c/5df311b3ed3db7bd7221dca18795fd1a.png" alt="5df311b3ed3db7bd7221dca18795fd1a.png"><br><img data-src="/2022/6d7c/2ffce6578af5e74817d11de5550720cd.png" alt="2ffce6578af5e74817d11de5550720cd.png"><br>(我們把票給別人了，無法投，並且先看一下propsal)<br><img data-src="/2022/6d7c/9260e0e053c89ee645efeca41703bfba.png" alt="9260e0e053c89ee645efeca41703bfba.png"><br>能看到沒有投成功<br><img data-src="/2022/6d7c/834c890042afc1541f94fc1f328d9add.png" alt="834c890042afc1541f94fc1f328d9add.png"></p>
<p>切換成其他人開始投票:<br>0x7CB7374abE10dDd7e16b3dfe5E68623DAb1b13F3<br>0x9AD3eB9367f6B123a843AcF946e4D360c445FB9d<br>執行vote<br><img data-src="/2022/6d7c/76a1125299a3e9dfa09f0873a9438c8c.png" alt="76a1125299a3e9dfa09f0873a9438c8c.png"><br><img data-src="/2022/6d7c/5ff749732431754ff317ebb3d246e551.png" alt="5ff749732431754ff317ebb3d246e551.png"><br>接著看proposal(Alice, Bob):<br><img data-src="/2022/6d7c/02953c4bf5ce86b50cea475500955786.png" alt="02953c4bf5ce86b50cea475500955786.png"></p>
<p>呼叫WINNERNAME和WINNINGPROPOSAL<br><img data-src="/2022/6d7c/2297887d4239991f95b92da765d5e315.png" alt="2297887d4239991f95b92da765d5e315.png"><br><img data-src="/2022/6d7c/bee24a7df5dea92ab6e26c8bcb0c0ca7.png" alt="bee24a7df5dea92ab6e26c8bcb0c0ca7.png"></p>
<p>合約內的東西都測試完畢</p>
<hr>
<p>Reference:</p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=GB3hiiNNDjk">Solidity by Example</a></p>
<p>..</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-tw,en,default">
    <link itemprop="mainEntityOfPage" href="https://www.fufunote.com/2022/3ea/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="FufuShih">
      <meta itemprop="description" content="裡是我紀錄、思考與分享的Blog，我會將一些在日常上的應用以及一些日常上常會遇到的問題給記錄下來。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="阿甫筆記——紀錄、思考與分享">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/3ea/" class="post-title-link" itemprop="url">flutter實現懸停時縮放圖片</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-04-14 19:45:39 / Modified: 19:54:01" itemprop="dateCreated datePublished" datetime="2022-04-14T19:45:39+08:00">2022-04-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/flutter/" itemprop="url" rel="index"><span itemprop="name">flutter</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2022/3ea/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2022/3ea/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>2 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="實現當懸停時，圖片縮放"><a href="#實現當懸停時，圖片縮放" class="headerlink" title="實現當懸停時，圖片縮放"></a>實現當懸停時，圖片縮放</h2><p><img data-src="/2022/3ea/app-test.gif" alt="app-test.gif"></p>
<h2 id="如何實現"><a href="#如何實現" class="headerlink" title="如何實現?"></a>如何實現?</h2><p>使用 <a target="_blank" rel="noopener" href="https://api.flutter.dev/flutter/widgets/AnimatedContainer-class.html"><strong>AnimatedContainer</strong></a> 來實現動畫效果並使用 <a target="_blank" rel="noopener" href="https://api.flutter.dev/flutter/material/InkWell-class.html"><strong>InkWell</strong></a> 來偵測懸停。</p>
<p>In InkWell:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">InkWell(</span><br><span class="line">        onTap: () &#123;</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&#x27;Tap&#x27;</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// Detect hover here</span></span><br><span class="line">        onHover: (val) &#123;</span><br><span class="line">          setState(() &#123;</span><br><span class="line">            isHover = val;</span><br><span class="line">            <span class="built_in">print</span>(val);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        child: <span class="comment">//Child</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>In AnimatedContainer:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">AnimatedContainer(</span><br><span class="line">            transform: isHover ? hoverdTransform : unhoverdTransform,</span><br><span class="line">            <span class="comment">// duraction time</span></span><br><span class="line">            duration: <span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">10</span>),</span><br><span class="line">            curve: Curves.ease,</span><br><span class="line">            child: Image.network(</span><br><span class="line">              imageUrl,</span><br><span class="line">              fit: BoxFit.cover,</span><br><span class="line">              height: <span class="number">200</span>,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br></pre></td></tr></table></figure>

<p>Full Code:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:convert&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:io&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  runApp(</span><br><span class="line">    MaterialApp(</span><br><span class="line">      home: Home(),</span><br><span class="line">    ),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Home</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _HomeState createState() =&gt; _HomeState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_HomeState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">Home</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      body: ZoomAnimate(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ZoomAnimate</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ZoomAnimate(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  State&lt;ZoomAnimate&gt; createState() =&gt; _ZoomAnimateState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_ZoomAnimateState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">ZoomAnimate</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">bool</span> isHover = <span class="keyword">false</span>;</span><br><span class="line">  <span class="built_in">String</span> imageUrl =</span><br><span class="line">      <span class="string">&quot;https://upload.wikimedia.org/wikipedia/commons/thumb/e/eb/Ash_Tree_-_geograph.org.uk_-_590710.jpg/220px-Ash_Tree_-_geograph.org.uk_-_590710.jpg&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">final</span> hoverdTransform = Matrix4.identity()..scale(<span class="number">1.2</span>);</span><br><span class="line">    <span class="keyword">final</span> unhoverdTransform = Matrix4.identity()..scale(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> Padding(</span><br><span class="line">      padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">8.0</span>),</span><br><span class="line">      child: InkWell(</span><br><span class="line">        onTap: () &#123;</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&#x27;Tap&#x27;</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        onHover: (val) &#123;</span><br><span class="line">          setState(() &#123;</span><br><span class="line">            isHover = val;</span><br><span class="line">            <span class="built_in">print</span>(val);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        child: ClipRRect(</span><br><span class="line">          borderRadius: BorderRadius.circular(<span class="number">8.0</span>),</span><br><span class="line">          child: AnimatedContainer(</span><br><span class="line">            transform: isHover ? hoverdTransform : unhoverdTransform,</span><br><span class="line">            duration: <span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">10</span>),</span><br><span class="line">            curve: Curves.ease,</span><br><span class="line">            child: Image.network(</span><br><span class="line">              imageUrl,</span><br><span class="line">              fit: BoxFit.cover,</span><br><span class="line">              height: <span class="number">200</span>,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-tw,en,default">
    <link itemprop="mainEntityOfPage" href="https://www.fufunote.com/2022/2de4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="FufuShih">
      <meta itemprop="description" content="裡是我紀錄、思考與分享的Blog，我會將一些在日常上的應用以及一些日常上常會遇到的問題給記錄下來。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="阿甫筆記——紀錄、思考與分享">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/2de4/" class="post-title-link" itemprop="url">在windows裡嘗試Solana</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-03-11 00:20:19 / Modified: 00:34:19" itemprop="dateCreated datePublished" datetime="2022-03-11T00:20:19+08:00">2022-03-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/solana/" itemprop="url" rel="index"><span itemprop="name">solana</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2022/2de4/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2022/2de4/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Solana-HelloWorld-in-win10"><a href="#Solana-HelloWorld-in-win10" class="headerlink" title="Solana: HelloWorld (in win10)"></a>Solana: HelloWorld (in win10)</h1><p><img data-src="/2022/2de4/embedded.svg" alt="image"></p>
<hr>
<p>首先，我們先安裝WSL<br><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/wsl/install">Install WSL | Microsoft Docs</a></p>
<p>在WSL中安裝rust-lang相關套件<br>Using WSL, in wsl terminal:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt install build-essential</span><br><span class="line"></span><br><span class="line">curl --proto &#x27;=https&#x27; --tlsv1.2 -sSf https://sh.rustup.rs | sh</span><br><span class="line"></span><br><span class="line">source $HOME/.cargo/env #Import the environment config for rust </span><br><span class="line"></span><br><span class="line">rustc --version #Test it</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>接著我們在WSL中安裝<a target="_blank" rel="noopener" href="https://docs.solana.com/cli/install-solana-cli-tools">solana tool</a>:</p>
<p>我們使用prebuilt binaries去安裝:<br><img data-src="/2022/2de4/unknown_filename.1.png" alt="image"><br>1.Download the file<br><strong>solana-release-x86_64-unknown-linux-msvc.tar.bz2</strong></p>
<p>2. in wsl terminal, run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar jxf solana-release-x86_64-unknown-linux-gnu.tar.bz2</span><br><span class="line">cd solana-release/</span><br><span class="line">export PATH=$PWD/bin:$PATH</span><br></pre></td></tr></table></figure>

<p>Goto example-helloworld, and run :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo build-bpf --manifest-path=./src/program-rust/Cargo.toml --bpf-out-dir=dist/program</span><br></pre></td></tr></table></figure>

<p>我們可以看到，正在build智能合約<br><img data-src="/2022/2de4/unknown_filename.png" alt="image"></p>
<p>接著我們能看到編譯完成後，出現了這些檔<br><img data-src="/2022/2de4/unknown_filename.2.png" alt="image"></p>
<p><img data-src="/2022/2de4/unknown_filename.3.png" alt="image"></p>
<hr>
<p>我們將他deploy到我們的local網上</p>
<p>首先先產生key</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">solana-keygen new -o /home/chenfu0217/.config/solana/id.json</span><br></pre></td></tr></table></figure>

<p><img data-src="/2022/2de4/Image.png" alt="image"><br><img data-src="/2022/2de4/unknown_filename.4.png" alt="image"><br>接著，我們將合約deploy到local網上</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">solana program deploy /mnt/f/_workspace/BlockChain/solana/example-helloworld/dist/program/helloworld.so</span><br></pre></td></tr></table></figure>

<p>We see</p>
<p><img data-src="/2022/2de4/unknown_filename.5.png" alt="image"></p>
<p><img data-src="/2022/2de4/unknown_filename.6.png" alt="image"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">solana config set --url localhost</span><br></pre></td></tr></table></figure>

<p>Set<br><img data-src="/2022/2de4/unknown_filename.7.png" alt="image"></p>
<p>Open new wsl terminal and run</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">solana-test-validator</span><br></pre></td></tr></table></figure>

<p><img data-src="/2022/2de4/unknown_filename.8.png" alt="image"></p>
<p>Get problem(<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/68906303/solana-hello-world-problem-on-windows-10-wsl2-ubuntu-18-04">Solved</a>)<br><img data-src="/2022/2de4/unknown_filename.10.png" alt="image"></p>
<p>這是因為WSL中目錄關係所造成的問題，使用”cd ~/“切換目錄<br><img data-src="/2022/2de4/unknown_filename.9.png" alt="image"><br>=&gt;<br><img data-src="/2022/2de4/unknown_filename.11.png" alt="image"></p>
<p>Now we deploy it</p>
<p>open new terminal and run<br><img data-src="/2022/2de4/unknown_filename.12.png" alt="image"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$PWD/bin:$PATH</span><br></pre></td></tr></table></figure>
<p>And </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">solana program deploy /mnt/f/_workspace/BlockChain/solana/example-helloworld/dist/program/helloworld.so</span><br></pre></td></tr></table></figure>

<p><img data-src="/2022/2de4/unknown_filename.13.png" alt="image"></p>
<p>Back to the origin terminal, and use npm to run</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run start</span><br></pre></td></tr></table></figure>
<p>we see<br><img data-src="/2022/2de4/unknown_filename.14.png" alt="image"></p>
<p>If we stop WSL<br><img data-src="/2022/2de4/unknown_filename.15.png" alt="image"><br>And back to test, we see<br><img data-src="/2022/2de4/unknown_filename.16.png" alt="image"></p>
<p>Reference:</p>
<p><a target="_blank" rel="noopener" href="https://docs.rs/solana-program/1.8.5/solana_program/">solana_program</a><br><a target="_blank" rel="noopener" href="https://docs.rs/solana-sdk/1.8.5/solana_sdk/">solana_sdk</a></p>
<p>..</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-tw,en,default">
    <link itemprop="mainEntityOfPage" href="https://www.fufunote.com/2022/f345/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="FufuShih">
      <meta itemprop="description" content="裡是我紀錄、思考與分享的Blog，我會將一些在日常上的應用以及一些日常上常會遇到的問題給記錄下來。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="阿甫筆記——紀錄、思考與分享">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/f345/" class="post-title-link" itemprop="url">使用cmc api來建立一個flutter app</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-01-08 13:35:29" itemprop="dateCreated datePublished" datetime="2022-01-08T13:35:29+08:00">2022-01-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-03-11 00:28:32" itemprop="dateModified" datetime="2022-03-11T00:28:32+08:00">2022-03-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/flutter/" itemprop="url" rel="index"><span itemprop="name">flutter</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2022/f345/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2022/f345/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>15 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="創建加密貨幣app"><a href="#創建加密貨幣app" class="headerlink" title="創建加密貨幣app"></a>創建加密貨幣app</h1><p><a target="_blank" rel="noopener" href="https://coinmarketcap.com/api/">coinmarketcap</a></p>
<p>registe and verifiy email:<br><img data-src="/2022/f345/2022-01-07-22-05-05.png" alt="verify"></p>
<p>copy api:<br><img data-src="/2022/f345/2022-01-07-22-12-52.png" alt="copy api"></p>
<p>project structure:<br><img data-src="/2022/f345/2022-01-08-13-24-45.png" alt="project structure"></p>
<p>package<br><img data-src="/2022/f345/2022-01-08-13-25-15.png" alt="package"></p>
<h2 id="Core"><a href="#Core" class="headerlink" title="Core"></a>Core</h2><p>models/payload_model.dart:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// To parse this JSON data, do</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//     final payloadModel = payloadModelFromMap(jsonString);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:convert&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PayloadModel</span> </span>&#123;</span><br><span class="line">  PayloadModel(&#123;</span><br><span class="line">    <span class="keyword">this</span>.status,</span><br><span class="line">    <span class="keyword">this</span>.data,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  Status? status;</span><br><span class="line">  <span class="built_in">List</span>&lt;Datum&gt;? data;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> PayloadModel.fromJson(<span class="built_in">String</span> str) =&gt;</span><br><span class="line">      PayloadModel.fromMap(json.decode(str));</span><br><span class="line"></span><br><span class="line">  <span class="built_in">String</span> toJson() =&gt; json.encode(toMap());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> PayloadModel.fromMap(<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; json) =&gt; PayloadModel(</span><br><span class="line">        status: json[<span class="string">&quot;status&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : Status.fromMap(json[<span class="string">&quot;status&quot;</span>]),</span><br><span class="line">        data: json[<span class="string">&quot;data&quot;</span>] == <span class="keyword">null</span></span><br><span class="line">            ? <span class="keyword">null</span></span><br><span class="line">            : <span class="built_in">List</span>&lt;Datum&gt;.from(json[<span class="string">&quot;data&quot;</span>].map((x) =&gt; Datum.fromMap(x))),</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; toMap() =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;status&quot;</span>: status == <span class="keyword">null</span> ? <span class="keyword">null</span> : status!.toMap(),</span><br><span class="line">        <span class="string">&quot;data&quot;</span>: data == <span class="keyword">null</span></span><br><span class="line">            ? <span class="keyword">null</span></span><br><span class="line">            : <span class="built_in">List</span>&lt;<span class="built_in">dynamic</span>&gt;.from(data!.map((x) =&gt; x.toMap())),</span><br><span class="line">      &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Datum</span> </span>&#123;</span><br><span class="line">  Datum(&#123;</span><br><span class="line">    <span class="keyword">this</span>.id,</span><br><span class="line">    <span class="keyword">this</span>.name,</span><br><span class="line">    <span class="keyword">this</span>.symbol,</span><br><span class="line">    <span class="keyword">this</span>.slug,</span><br><span class="line">    <span class="keyword">this</span>.numMarketPairs,</span><br><span class="line">    <span class="keyword">this</span>.dateAdded,</span><br><span class="line">    <span class="keyword">this</span>.tags,</span><br><span class="line">    <span class="keyword">this</span>.maxSupply,</span><br><span class="line">    <span class="keyword">this</span>.circulatingSupply,</span><br><span class="line">    <span class="keyword">this</span>.totalSupply,</span><br><span class="line">    <span class="keyword">this</span>.platform,</span><br><span class="line">    <span class="keyword">this</span>.cmcRank,</span><br><span class="line">    <span class="keyword">this</span>.lastUpdated,</span><br><span class="line">    <span class="keyword">this</span>.quote,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">int?</span> id;</span><br><span class="line">  <span class="built_in">String?</span> name;</span><br><span class="line">  <span class="built_in">String?</span> symbol;</span><br><span class="line">  <span class="built_in">String?</span> slug;</span><br><span class="line">  <span class="built_in">int?</span> numMarketPairs;</span><br><span class="line">  <span class="built_in">DateTime?</span> dateAdded;</span><br><span class="line">  <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;? tags;</span><br><span class="line">  <span class="built_in">int?</span> maxSupply;</span><br><span class="line">  <span class="built_in">double?</span> circulatingSupply;</span><br><span class="line">  <span class="built_in">double?</span> totalSupply;</span><br><span class="line">  Platform? platform;</span><br><span class="line">  <span class="built_in">int?</span> cmcRank;</span><br><span class="line">  <span class="built_in">DateTime?</span> lastUpdated;</span><br><span class="line">  Quote? quote;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> Datum.fromJson(<span class="built_in">String</span> str) =&gt; Datum.fromMap(json.decode(str));</span><br><span class="line"></span><br><span class="line">  <span class="built_in">String</span> toJson() =&gt; json.encode(toMap());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> Datum.fromMap(<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; json) =&gt; Datum(</span><br><span class="line">        id: json[<span class="string">&quot;id&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : json[<span class="string">&quot;id&quot;</span>],</span><br><span class="line">        name: json[<span class="string">&quot;name&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : json[<span class="string">&quot;name&quot;</span>],</span><br><span class="line">        symbol: json[<span class="string">&quot;symbol&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : json[<span class="string">&quot;symbol&quot;</span>],</span><br><span class="line">        slug: json[<span class="string">&quot;slug&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : json[<span class="string">&quot;slug&quot;</span>],</span><br><span class="line">        numMarketPairs:</span><br><span class="line">            json[<span class="string">&quot;num_market_pairs&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : json[<span class="string">&quot;num_market_pairs&quot;</span>],</span><br><span class="line">        dateAdded: json[<span class="string">&quot;date_added&quot;</span>] == <span class="keyword">null</span></span><br><span class="line">            ? <span class="keyword">null</span></span><br><span class="line">            : <span class="built_in">DateTime</span>.parse(json[<span class="string">&quot;date_added&quot;</span>]),</span><br><span class="line">        tags: json[<span class="string">&quot;tags&quot;</span>] == <span class="keyword">null</span></span><br><span class="line">            ? <span class="keyword">null</span></span><br><span class="line">            : <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;.from(json[<span class="string">&quot;tags&quot;</span>].map((x) =&gt; x)),</span><br><span class="line">        maxSupply: json[<span class="string">&quot;max_supply&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : json[<span class="string">&quot;max_supply&quot;</span>],</span><br><span class="line">        circulatingSupply: json[<span class="string">&quot;circulating_supply&quot;</span>] == <span class="keyword">null</span></span><br><span class="line">            ? <span class="keyword">null</span></span><br><span class="line">            : json[<span class="string">&quot;circulating_supply&quot;</span>].toDouble(),</span><br><span class="line">        totalSupply: json[<span class="string">&quot;total_supply&quot;</span>] == <span class="keyword">null</span></span><br><span class="line">            ? <span class="keyword">null</span></span><br><span class="line">            : json[<span class="string">&quot;total_supply&quot;</span>].toDouble(),</span><br><span class="line">        platform: json[<span class="string">&quot;platform&quot;</span>] == <span class="keyword">null</span></span><br><span class="line">            ? <span class="keyword">null</span></span><br><span class="line">            : Platform.fromMap(json[<span class="string">&quot;platform&quot;</span>]),</span><br><span class="line">        cmcRank: json[<span class="string">&quot;cmc_rank&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : json[<span class="string">&quot;cmc_rank&quot;</span>],</span><br><span class="line">        lastUpdated: json[<span class="string">&quot;last_updated&quot;</span>] == <span class="keyword">null</span></span><br><span class="line">            ? <span class="keyword">null</span></span><br><span class="line">            : <span class="built_in">DateTime</span>.parse(json[<span class="string">&quot;last_updated&quot;</span>]),</span><br><span class="line">        quote: json[<span class="string">&quot;quote&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : Quote.fromMap(json[<span class="string">&quot;quote&quot;</span>]),</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; toMap() =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: id == <span class="keyword">null</span> ? <span class="keyword">null</span> : id,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: name == <span class="keyword">null</span> ? <span class="keyword">null</span> : name,</span><br><span class="line">        <span class="string">&quot;symbol&quot;</span>: symbol == <span class="keyword">null</span> ? <span class="keyword">null</span> : symbol,</span><br><span class="line">        <span class="string">&quot;slug&quot;</span>: slug == <span class="keyword">null</span> ? <span class="keyword">null</span> : slug,</span><br><span class="line">        <span class="string">&quot;num_market_pairs&quot;</span>: numMarketPairs == <span class="keyword">null</span> ? <span class="keyword">null</span> : numMarketPairs,</span><br><span class="line">        <span class="string">&quot;date_added&quot;</span>: dateAdded == <span class="keyword">null</span> ? <span class="keyword">null</span> : dateAdded!.toIso8601String(),</span><br><span class="line">        <span class="string">&quot;tags&quot;</span>: tags == <span class="keyword">null</span> ? <span class="keyword">null</span> : <span class="built_in">List</span>&lt;<span class="built_in">dynamic</span>&gt;.from(tags!.map((x) =&gt; x)),</span><br><span class="line">        <span class="string">&quot;max_supply&quot;</span>: maxSupply == <span class="keyword">null</span> ? <span class="keyword">null</span> : maxSupply,</span><br><span class="line">        <span class="string">&quot;circulating_supply&quot;</span>:</span><br><span class="line">            circulatingSupply == <span class="keyword">null</span> ? <span class="keyword">null</span> : circulatingSupply,</span><br><span class="line">        <span class="string">&quot;total_supply&quot;</span>: totalSupply == <span class="keyword">null</span> ? <span class="keyword">null</span> : totalSupply,</span><br><span class="line">        <span class="string">&quot;platform&quot;</span>: platform == <span class="keyword">null</span> ? <span class="keyword">null</span> : platform!.toMap(),</span><br><span class="line">        <span class="string">&quot;cmc_rank&quot;</span>: cmcRank == <span class="keyword">null</span> ? <span class="keyword">null</span> : cmcRank,</span><br><span class="line">        <span class="string">&quot;last_updated&quot;</span>:</span><br><span class="line">            lastUpdated == <span class="keyword">null</span> ? <span class="keyword">null</span> : lastUpdated!.toIso8601String(),</span><br><span class="line">        <span class="string">&quot;quote&quot;</span>: quote == <span class="keyword">null</span> ? <span class="keyword">null</span> : quote!.toMap(),</span><br><span class="line">      &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Platform</span> </span>&#123;</span><br><span class="line">  Platform(&#123;</span><br><span class="line">    <span class="keyword">this</span>.id,</span><br><span class="line">    <span class="keyword">this</span>.name,</span><br><span class="line">    <span class="keyword">this</span>.symbol,</span><br><span class="line">    <span class="keyword">this</span>.slug,</span><br><span class="line">    <span class="keyword">this</span>.tokenAddress,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">int?</span> id;</span><br><span class="line">  Name? name;</span><br><span class="line">  <span class="built_in">Symbol?</span> symbol;</span><br><span class="line">  Slug? slug;</span><br><span class="line">  <span class="built_in">String?</span> tokenAddress;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> Platform.fromJson(<span class="built_in">String</span> str) =&gt; Platform.fromMap(json.decode(str));</span><br><span class="line"></span><br><span class="line">  <span class="built_in">String</span> toJson() =&gt; json.encode(toMap());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> Platform.fromMap(<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; json) =&gt; Platform(</span><br><span class="line">        id: json[<span class="string">&quot;id&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : json[<span class="string">&quot;id&quot;</span>],</span><br><span class="line">        name: json[<span class="string">&quot;name&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : nameValues.map[json[<span class="string">&quot;name&quot;</span>]],</span><br><span class="line">        symbol:</span><br><span class="line">            json[<span class="string">&quot;symbol&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : symbolValues.map[json[<span class="string">&quot;symbol&quot;</span>]],</span><br><span class="line">        slug: json[<span class="string">&quot;slug&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : slugValues.map[json[<span class="string">&quot;slug&quot;</span>]],</span><br><span class="line">        tokenAddress:</span><br><span class="line">            json[<span class="string">&quot;token_address&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : json[<span class="string">&quot;token_address&quot;</span>],</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; toMap() =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: id == <span class="keyword">null</span> ? <span class="keyword">null</span> : id,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: name == <span class="keyword">null</span> ? <span class="keyword">null</span> : nameValues.reverse[name],</span><br><span class="line">        <span class="string">&quot;symbol&quot;</span>: symbol == <span class="keyword">null</span> ? <span class="keyword">null</span> : symbolValues.reverse[symbol],</span><br><span class="line">        <span class="string">&quot;slug&quot;</span>: slug == <span class="keyword">null</span> ? <span class="keyword">null</span> : slugValues.reverse[slug],</span><br><span class="line">        <span class="string">&quot;token_address&quot;</span>: tokenAddress == <span class="keyword">null</span> ? <span class="keyword">null</span> : tokenAddress,</span><br><span class="line">      &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> Name &#123;</span><br><span class="line">  ETHEREUM,</span><br><span class="line">  BINANCE_CHAIN_BEP2,</span><br><span class="line">  BINANCE_SMART_CHAIN_BEP20,</span><br><span class="line">  TRON10,</span><br><span class="line">  KLAYTN,</span><br><span class="line">  TRON20</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> nameValues = EnumValues(&#123;</span><br><span class="line">  <span class="string">&quot;Binance Chain (BEP2)&quot;</span>: Name.BINANCE_CHAIN_BEP2,</span><br><span class="line">  <span class="string">&quot;Binance Smart Chain (BEP20)&quot;</span>: Name.BINANCE_SMART_CHAIN_BEP20,</span><br><span class="line">  <span class="string">&quot;Ethereum&quot;</span>: Name.ETHEREUM,</span><br><span class="line">  <span class="string">&quot;Klaytn&quot;</span>: Name.KLAYTN,</span><br><span class="line">  <span class="string">&quot;Tron10&quot;</span>: Name.TRON10,</span><br><span class="line">  <span class="string">&quot;Tron20&quot;</span>: Name.TRON20</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> Slug &#123; ETHEREUM, BINANCE_COIN, TRON, KLAYTN &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> slugValues = EnumValues(&#123;</span><br><span class="line">  <span class="string">&quot;binance-coin&quot;</span>: Slug.BINANCE_COIN,</span><br><span class="line">  <span class="string">&quot;ethereum&quot;</span>: Slug.ETHEREUM,</span><br><span class="line">  <span class="string">&quot;klaytn&quot;</span>: Slug.KLAYTN,</span><br><span class="line">  <span class="string">&quot;tron&quot;</span>: Slug.TRON</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="built_in">Symbol</span> &#123; ETH, BNB, TRX, KLAY &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> symbolValues = EnumValues(&#123;</span><br><span class="line">  <span class="string">&quot;BNB&quot;</span>: <span class="built_in">Symbol</span>.BNB,</span><br><span class="line">  <span class="string">&quot;ETH&quot;</span>: <span class="built_in">Symbol</span>.ETH,</span><br><span class="line">  <span class="string">&quot;KLAY&quot;</span>: <span class="built_in">Symbol</span>.KLAY,</span><br><span class="line">  <span class="string">&quot;TRX&quot;</span>: <span class="built_in">Symbol</span>.TRX</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Quote</span> </span>&#123;</span><br><span class="line">  Quote(&#123;</span><br><span class="line">    <span class="keyword">this</span>.usd,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  Usd? usd;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> Quote.fromJson(<span class="built_in">String</span> str) =&gt; Quote.fromMap(json.decode(str));</span><br><span class="line"></span><br><span class="line">  <span class="built_in">String</span> toJson() =&gt; json.encode(toMap());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> Quote.fromMap(<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; json) =&gt; Quote(</span><br><span class="line">        usd: json[<span class="string">&quot;USD&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : Usd.fromMap(json[<span class="string">&quot;USD&quot;</span>]),</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; toMap() =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;USD&quot;</span>: usd == <span class="keyword">null</span> ? <span class="keyword">null</span> : usd!.toMap(),</span><br><span class="line">      &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Usd</span> </span>&#123;</span><br><span class="line">  Usd(&#123;</span><br><span class="line">    <span class="keyword">this</span>.price,</span><br><span class="line">    <span class="keyword">this</span>.volume24H,</span><br><span class="line">    <span class="keyword">this</span>.volumeChange24H,</span><br><span class="line">    <span class="keyword">this</span>.percentChange1H,</span><br><span class="line">    <span class="keyword">this</span>.percentChange24H,</span><br><span class="line">    <span class="keyword">this</span>.percentChange7D,</span><br><span class="line">    <span class="keyword">this</span>.percentChange30D,</span><br><span class="line">    <span class="keyword">this</span>.percentChange60D,</span><br><span class="line">    <span class="keyword">this</span>.percentChange90D,</span><br><span class="line">    <span class="keyword">this</span>.marketCap,</span><br><span class="line">    <span class="keyword">this</span>.marketCapDominance,</span><br><span class="line">    <span class="keyword">this</span>.fullyDilutedMarketCap,</span><br><span class="line">    <span class="keyword">this</span>.lastUpdated,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">double?</span> price;</span><br><span class="line">  <span class="built_in">double?</span> volume24H;</span><br><span class="line">  <span class="built_in">double?</span> volumeChange24H;</span><br><span class="line">  <span class="built_in">double?</span> percentChange1H;</span><br><span class="line">  <span class="built_in">double?</span> percentChange24H;</span><br><span class="line">  <span class="built_in">double?</span> percentChange7D;</span><br><span class="line">  <span class="built_in">double?</span> percentChange30D;</span><br><span class="line">  <span class="built_in">double?</span> percentChange60D;</span><br><span class="line">  <span class="built_in">double?</span> percentChange90D;</span><br><span class="line">  <span class="built_in">double?</span> marketCap;</span><br><span class="line">  <span class="built_in">double?</span> marketCapDominance;</span><br><span class="line">  <span class="built_in">double?</span> fullyDilutedMarketCap;</span><br><span class="line">  <span class="built_in">DateTime?</span> lastUpdated;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> Usd.fromJson(<span class="built_in">String</span> str) =&gt; Usd.fromMap(json.decode(str));</span><br><span class="line"></span><br><span class="line">  <span class="built_in">String</span> toJson() =&gt; json.encode(toMap());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> Usd.fromMap(<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; json) =&gt; Usd(</span><br><span class="line">        price: json[<span class="string">&quot;price&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : json[<span class="string">&quot;price&quot;</span>].toDouble(),</span><br><span class="line">        volume24H:</span><br><span class="line">            json[<span class="string">&quot;volume_24h&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : json[<span class="string">&quot;volume_24h&quot;</span>].toDouble(),</span><br><span class="line">        volumeChange24H: json[<span class="string">&quot;volume_change_24h&quot;</span>] == <span class="keyword">null</span></span><br><span class="line">            ? <span class="keyword">null</span></span><br><span class="line">            : json[<span class="string">&quot;volume_change_24h&quot;</span>].toDouble(),</span><br><span class="line">        percentChange1H: json[<span class="string">&quot;percent_change_1h&quot;</span>] == <span class="keyword">null</span></span><br><span class="line">            ? <span class="keyword">null</span></span><br><span class="line">            : json[<span class="string">&quot;percent_change_1h&quot;</span>].toDouble(),</span><br><span class="line">        percentChange24H: json[<span class="string">&quot;percent_change_24h&quot;</span>] == <span class="keyword">null</span></span><br><span class="line">            ? <span class="keyword">null</span></span><br><span class="line">            : json[<span class="string">&quot;percent_change_24h&quot;</span>].toDouble(),</span><br><span class="line">        percentChange7D: json[<span class="string">&quot;percent_change_7d&quot;</span>] == <span class="keyword">null</span></span><br><span class="line">            ? <span class="keyword">null</span></span><br><span class="line">            : json[<span class="string">&quot;percent_change_7d&quot;</span>].toDouble(),</span><br><span class="line">        percentChange30D: json[<span class="string">&quot;percent_change_30d&quot;</span>] == <span class="keyword">null</span></span><br><span class="line">            ? <span class="keyword">null</span></span><br><span class="line">            : json[<span class="string">&quot;percent_change_30d&quot;</span>].toDouble(),</span><br><span class="line">        percentChange60D: json[<span class="string">&quot;percent_change_60d&quot;</span>] == <span class="keyword">null</span></span><br><span class="line">            ? <span class="keyword">null</span></span><br><span class="line">            : json[<span class="string">&quot;percent_change_60d&quot;</span>].toDouble(),</span><br><span class="line">        percentChange90D: json[<span class="string">&quot;percent_change_90d&quot;</span>] == <span class="keyword">null</span></span><br><span class="line">            ? <span class="keyword">null</span></span><br><span class="line">            : json[<span class="string">&quot;percent_change_90d&quot;</span>].toDouble(),</span><br><span class="line">        marketCap:</span><br><span class="line">            json[<span class="string">&quot;market_cap&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : json[<span class="string">&quot;market_cap&quot;</span>].toDouble(),</span><br><span class="line">        marketCapDominance: json[<span class="string">&quot;market_cap_dominance&quot;</span>] == <span class="keyword">null</span></span><br><span class="line">            ? <span class="keyword">null</span></span><br><span class="line">            : json[<span class="string">&quot;market_cap_dominance&quot;</span>].toDouble(),</span><br><span class="line">        fullyDilutedMarketCap: json[<span class="string">&quot;fully_diluted_market_cap&quot;</span>] == <span class="keyword">null</span></span><br><span class="line">            ? <span class="keyword">null</span></span><br><span class="line">            : json[<span class="string">&quot;fully_diluted_market_cap&quot;</span>].toDouble(),</span><br><span class="line">        lastUpdated: json[<span class="string">&quot;last_updated&quot;</span>] == <span class="keyword">null</span></span><br><span class="line">            ? <span class="keyword">null</span></span><br><span class="line">            : <span class="built_in">DateTime</span>.parse(json[<span class="string">&quot;last_updated&quot;</span>]),</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; toMap() =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;price&quot;</span>: price == <span class="keyword">null</span> ? <span class="keyword">null</span> : price,</span><br><span class="line">        <span class="string">&quot;volume_24h&quot;</span>: volume24H == <span class="keyword">null</span> ? <span class="keyword">null</span> : volume24H,</span><br><span class="line">        <span class="string">&quot;volume_change_24h&quot;</span>: volumeChange24H == <span class="keyword">null</span> ? <span class="keyword">null</span> : volumeChange24H,</span><br><span class="line">        <span class="string">&quot;percent_change_1h&quot;</span>: percentChange1H == <span class="keyword">null</span> ? <span class="keyword">null</span> : percentChange1H,</span><br><span class="line">        <span class="string">&quot;percent_change_24h&quot;</span>:</span><br><span class="line">            percentChange24H == <span class="keyword">null</span> ? <span class="keyword">null</span> : percentChange24H,</span><br><span class="line">        <span class="string">&quot;percent_change_7d&quot;</span>: percentChange7D == <span class="keyword">null</span> ? <span class="keyword">null</span> : percentChange7D,</span><br><span class="line">        <span class="string">&quot;percent_change_30d&quot;</span>:</span><br><span class="line">            percentChange30D == <span class="keyword">null</span> ? <span class="keyword">null</span> : percentChange30D,</span><br><span class="line">        <span class="string">&quot;percent_change_60d&quot;</span>:</span><br><span class="line">            percentChange60D == <span class="keyword">null</span> ? <span class="keyword">null</span> : percentChange60D,</span><br><span class="line">        <span class="string">&quot;percent_change_90d&quot;</span>:</span><br><span class="line">            percentChange90D == <span class="keyword">null</span> ? <span class="keyword">null</span> : percentChange90D,</span><br><span class="line">        <span class="string">&quot;market_cap&quot;</span>: marketCap == <span class="keyword">null</span> ? <span class="keyword">null</span> : marketCap,</span><br><span class="line">        <span class="string">&quot;market_cap_dominance&quot;</span>:</span><br><span class="line">            marketCapDominance == <span class="keyword">null</span> ? <span class="keyword">null</span> : marketCapDominance,</span><br><span class="line">        <span class="string">&quot;fully_diluted_market_cap&quot;</span>:</span><br><span class="line">            fullyDilutedMarketCap == <span class="keyword">null</span> ? <span class="keyword">null</span> : fullyDilutedMarketCap,</span><br><span class="line">        <span class="string">&quot;last_updated&quot;</span>:</span><br><span class="line">            lastUpdated == <span class="keyword">null</span> ? <span class="keyword">null</span> : lastUpdated!.toIso8601String(),</span><br><span class="line">      &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Status</span> </span>&#123;</span><br><span class="line">  Status(&#123;</span><br><span class="line">    <span class="keyword">this</span>.timestamp,</span><br><span class="line">    <span class="keyword">this</span>.errorCode,</span><br><span class="line">    <span class="keyword">this</span>.errorMessage,</span><br><span class="line">    <span class="keyword">this</span>.elapsed,</span><br><span class="line">    <span class="keyword">this</span>.creditCount,</span><br><span class="line">    <span class="keyword">this</span>.notice,</span><br><span class="line">    <span class="keyword">this</span>.totalCount,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">DateTime?</span> timestamp;</span><br><span class="line">  <span class="built_in">int?</span> errorCode;</span><br><span class="line">  dynamic? errorMessage;</span><br><span class="line">  <span class="built_in">int?</span> elapsed;</span><br><span class="line">  <span class="built_in">int?</span> creditCount;</span><br><span class="line">  dynamic? notice;</span><br><span class="line">  <span class="built_in">int?</span> totalCount;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> Status.fromJson(<span class="built_in">String</span> str) =&gt; Status.fromMap(json.decode(str));</span><br><span class="line"></span><br><span class="line">  <span class="built_in">String</span> toJson() =&gt; json.encode(toMap());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> Status.fromMap(<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; json) =&gt; Status(</span><br><span class="line">        timestamp: json[<span class="string">&quot;timestamp&quot;</span>] == <span class="keyword">null</span></span><br><span class="line">            ? <span class="keyword">null</span></span><br><span class="line">            : <span class="built_in">DateTime</span>.parse(json[<span class="string">&quot;timestamp&quot;</span>]),</span><br><span class="line">        errorCode: json[<span class="string">&quot;error_code&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : json[<span class="string">&quot;error_code&quot;</span>],</span><br><span class="line">        errorMessage: json[<span class="string">&quot;error_message&quot;</span>],</span><br><span class="line">        elapsed: json[<span class="string">&quot;elapsed&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : json[<span class="string">&quot;elapsed&quot;</span>],</span><br><span class="line">        creditCount: json[<span class="string">&quot;credit_count&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : json[<span class="string">&quot;credit_count&quot;</span>],</span><br><span class="line">        notice: json[<span class="string">&quot;notice&quot;</span>],</span><br><span class="line">        totalCount: json[<span class="string">&quot;total_count&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : json[<span class="string">&quot;total_count&quot;</span>],</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; toMap() =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;timestamp&quot;</span>: timestamp == <span class="keyword">null</span> ? <span class="keyword">null</span> : timestamp!.toIso8601String(),</span><br><span class="line">        <span class="string">&quot;error_code&quot;</span>: errorCode == <span class="keyword">null</span> ? <span class="keyword">null</span> : errorCode,</span><br><span class="line">        <span class="string">&quot;error_message&quot;</span>: errorMessage,</span><br><span class="line">        <span class="string">&quot;elapsed&quot;</span>: elapsed == <span class="keyword">null</span> ? <span class="keyword">null</span> : elapsed,</span><br><span class="line">        <span class="string">&quot;credit_count&quot;</span>: creditCount == <span class="keyword">null</span> ? <span class="keyword">null</span> : creditCount,</span><br><span class="line">        <span class="string">&quot;notice&quot;</span>: notice,</span><br><span class="line">        <span class="string">&quot;total_count&quot;</span>: totalCount == <span class="keyword">null</span> ? <span class="keyword">null</span> : totalCount,</span><br><span class="line">      &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EnumValues</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, T&gt; map;</span><br><span class="line">  <span class="keyword">late</span> <span class="built_in">Map</span>&lt;T, <span class="built_in">String</span>&gt; reverseMap;</span><br><span class="line"></span><br><span class="line">  EnumValues(<span class="keyword">this</span>.map);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Map</span>&lt;T, <span class="built_in">String</span>&gt; <span class="keyword">get</span> reverse &#123;</span><br><span class="line">    <span class="keyword">if</span> (reverseMap == <span class="keyword">null</span>) &#123;</span><br><span class="line">      reverseMap = map.map((k, v) =&gt; <span class="keyword">new</span> MapEntry(v, k));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> reverseMap;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>models.dart:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="string">&#x27;./payload_model.dart&#x27;</span>;</span><br></pre></td></tr></table></figure>

<hr>
<p>services/payload_service.dart:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:developer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_get_balance/core/models/models.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:http/http.dart&#x27;</span> <span class="keyword">as</span> http;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PayloadService</span> </span>&#123;</span><br><span class="line">  Future&lt;PayloadModel?&gt; getCryptoPrices() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> key = <span class="string">&#x27;*******-****-****-****-************&#x27;</span>; <span class="comment">// add your api key here</span></span><br><span class="line">      <span class="keyword">var</span> headers = &#123;</span><br><span class="line">        <span class="string">&#x27;X-CMC_PRO_API_KEY&#x27;</span>: key,</span><br><span class="line">        <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">var</span> url = <span class="built_in">Uri</span>.parse(</span><br><span class="line">          <span class="string">&#x27;https://pro-api.coinmarketcap.com/v1/cryptocurrency/listings/latest&#x27;</span>);</span><br><span class="line">      <span class="keyword">final</span> response = <span class="keyword">await</span> http.<span class="keyword">get</span>(url, headers: headers);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (response.statusCode == <span class="number">200</span>) &#123;</span><br><span class="line">        PayloadModel payload = PayloadModel.fromJson(response.body);</span><br><span class="line">        <span class="keyword">return</span> payload;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        log(<span class="string">&#x27;請求失敗&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      log(<span class="string">&#x27;post fetch and set catch error&#x27;</span>, error: err);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>services.dart:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="string">&#x27;./payload_service.dart&#x27;</span>;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="UI"><a href="#UI" class="headerlink" title="UI"></a>UI</h2><p>ui/home_screen.dart:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_get_balance/core/models/models.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_get_balance/core/services/services.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeScreen</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> HomeScreen(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _HomeScreenState createState() =&gt; _HomeScreenState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_HomeScreenState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">HomeScreen</span>&gt; </span>&#123;</span><br><span class="line">  PayloadService service = PayloadService();</span><br><span class="line">  <span class="keyword">late</span> Future&lt;PayloadModel?&gt; _future;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement initState</span></span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    _future = service.getCryptoPrices();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">        appBar: AppBar(</span><br><span class="line">          title: <span class="keyword">const</span> Text(<span class="string">&#x27;Cryptos&#x27;</span>),</span><br><span class="line">        ),</span><br><span class="line">        <span class="comment">// body: ListView.builder(</span></span><br><span class="line">        <span class="comment">//     itemCount: _payload?.data.length,</span></span><br><span class="line">        <span class="comment">//     itemBuilder: (context, index) &#123;</span></span><br><span class="line">        <span class="comment">//       return Card(</span></span><br><span class="line">        <span class="comment">//         elevation: 6.0,</span></span><br><span class="line">        <span class="comment">//         child: Padding(</span></span><br><span class="line">        <span class="comment">//           padding: const EdgeInsets.only(</span></span><br><span class="line">        <span class="comment">//               top: 6.0, bottom: 6.0, left: 8.0, right: 8.0),</span></span><br><span class="line">        <span class="comment">//           child: Row(</span></span><br><span class="line">        <span class="comment">//             crossAxisAlignment: CrossAxisAlignment.start,</span></span><br><span class="line">        <span class="comment">//             children: &lt;Widget&gt;[</span></span><br><span class="line">        <span class="comment">//               Text(_payload?.data[index].name ?? &#x27;&#x27;),</span></span><br><span class="line">        <span class="comment">//               const Spacer(),</span></span><br><span class="line">        <span class="comment">//               Text(_payload?.data[index].lastUpdated!.toIso8601String() ??</span></span><br><span class="line">        <span class="comment">//                   &#x27;&#x27;),</span></span><br><span class="line">        <span class="comment">//               const Spacer(),</span></span><br><span class="line">        <span class="comment">//               Text(</span></span><br><span class="line">        <span class="comment">//                 _payload?.data[index].quote!.usd!.price.toString() ?? &#x27;&#x27;,</span></span><br><span class="line">        <span class="comment">//               ),</span></span><br><span class="line">        <span class="comment">//             ],</span></span><br><span class="line">        <span class="comment">//           ),</span></span><br><span class="line">        <span class="comment">//         ),</span></span><br><span class="line">        <span class="comment">//       );</span></span><br><span class="line">        <span class="comment">//     &#125;),</span></span><br><span class="line">        body: FutureBuilder(</span><br><span class="line">            future: _future,</span><br><span class="line">            builder: (context, AsyncSnapshot&lt;PayloadModel?&gt; snapshot) &#123;</span><br><span class="line">              <span class="keyword">switch</span> (snapshot.connectionState) &#123;</span><br><span class="line">                <span class="keyword">case</span> ConnectionState.none:</span><br><span class="line">                  <span class="keyword">return</span> Text(<span class="string">&#x27;none&#x27;</span>);</span><br><span class="line">                <span class="keyword">case</span> ConnectionState.waiting:</span><br><span class="line">                  <span class="keyword">return</span> Center(child: CircularProgressIndicator());</span><br><span class="line">                <span class="keyword">case</span> ConnectionState.active:</span><br><span class="line">                  <span class="keyword">return</span> Text(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                <span class="keyword">case</span> ConnectionState.done:</span><br><span class="line">                  <span class="keyword">if</span> (snapshot.hasError) &#123;</span><br><span class="line">                    <span class="keyword">return</span> Text(</span><br><span class="line">                      <span class="string">&#x27;<span class="subst">$&#123;snapshot.error&#125;</span>&#x27;</span>,</span><br><span class="line">                      style: TextStyle(color: Colors.red),</span><br><span class="line">                    );</span><br><span class="line">                  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> ListView.builder(</span><br><span class="line">                        itemCount: snapshot.data?.data!.length,</span><br><span class="line">                        itemBuilder: (context, index) &#123;</span><br><span class="line">                          <span class="keyword">return</span> Card(</span><br><span class="line">                              elevation: <span class="number">6.0</span>,</span><br><span class="line">                              child: Padding(</span><br><span class="line">                                padding: <span class="keyword">const</span> EdgeInsets.only(</span><br><span class="line">                                    top: <span class="number">6.0</span>,</span><br><span class="line">                                    bottom: <span class="number">6.0</span>,</span><br><span class="line">                                    left: <span class="number">8.0</span>,</span><br><span class="line">                                    right: <span class="number">8.0</span>),</span><br><span class="line">                                child: Row(</span><br><span class="line">                                  crossAxisAlignment: CrossAxisAlignment.start,</span><br><span class="line">                                  children: &lt;Widget&gt;[</span><br><span class="line">                                    Text(snapshot.data?.data?[index].name ??</span><br><span class="line">                                        <span class="string">&#x27;Name Null&#x27;</span>),</span><br><span class="line">                                    Spacer(),</span><br><span class="line">                                    Text(snapshot.data?.data?[index].lastUpdated</span><br><span class="line">                                            ?.toIso8601String() ??</span><br><span class="line">                                        <span class="string">&#x27;lastUpdated null&#x27;</span>),</span><br><span class="line">                                    Spacer(),</span><br><span class="line">                                    Text(</span><br><span class="line">                                      snapshot.data?.data?[index].quote?.usd</span><br><span class="line">                                              ?.price</span><br><span class="line">                                              .toString() ??</span><br><span class="line">                                          <span class="string">&#x27;price null&#x27;</span>,</span><br><span class="line">                                    ),</span><br><span class="line">                                  ],</span><br><span class="line">                                ),</span><br><span class="line">                              ));</span><br><span class="line">                        &#125;);</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>main:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_get_balance/ui/home_screen.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  runApp(<span class="keyword">const</span> MyApp());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> MyApp(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// This widget is the root of your application.</span></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      title: <span class="string">&#x27;Flutter Demo&#x27;</span>,</span><br><span class="line">      theme: ThemeData(</span><br><span class="line">        <span class="comment">// This is the theme of your application.</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">// Try running your application with &quot;flutter run&quot;. You&#x27;ll see the</span></span><br><span class="line">        <span class="comment">// application has a blue toolbar. Then, without quitting the app, try</span></span><br><span class="line">        <span class="comment">// changing the primarySwatch below to Colors.green and then invoke</span></span><br><span class="line">        <span class="comment">// &quot;hot reload&quot; (press &quot;r&quot; in the console where you ran &quot;flutter run&quot;,</span></span><br><span class="line">        <span class="comment">// or simply save your changes to &quot;hot reload&quot; in a Flutter IDE).</span></span><br><span class="line">        <span class="comment">// Notice that the counter didn&#x27;t reset back to zero; the application</span></span><br><span class="line">        <span class="comment">// is not restarted.</span></span><br><span class="line">        primarySwatch: Colors.blue,</span><br><span class="line">      ),</span><br><span class="line">      home: HomeScreen(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h2><p><img data-src="/2022/f345/app-test.gif" alt="test gif"></p>
<p><img data-src="/2022/f345/2022-01-08-13-31-38.png" alt="http"></p>
<p><img data-src="/2022/f345/2022-01-08-13-31-59.png" alt="response"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-tw,en,default">
    <link itemprop="mainEntityOfPage" href="https://www.fufunote.com/2021/9ca0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="FufuShih">
      <meta itemprop="description" content="裡是我紀錄、思考與分享的Blog，我會將一些在日常上的應用以及一些日常上常會遇到的問題給記錄下來。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="阿甫筆記——紀錄、思考與分享">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/9ca0/" class="post-title-link" itemprop="url">Flutter串接restful api</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-12-29 14:13:32" itemprop="dateCreated datePublished" datetime="2021-12-29T14:13:32+08:00">2021-12-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-03-11 00:28:32" itemprop="dateModified" datetime="2022-03-11T00:28:32+08:00">2022-03-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/flutter/" itemprop="url" rel="index"><span itemprop="name">flutter</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2021/9ca0/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/9ca0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>10 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Flutter串接restful-api"><a href="#Flutter串接restful-api" class="headerlink" title="Flutter串接restful api"></a>Flutter串接restful api</h1><h2 id="創建新專案"><a href="#創建新專案" class="headerlink" title="創建新專案"></a>創建新專案</h2><p>架構:<br><img data-src="/2021/9ca0/2022-01-03-12-59-32.png" alt="Image"></p>
<p>package<br><img data-src="/2021/9ca0/2022-01-03-13-00-12.png" alt="pubspec"></p>
<p>使用JSONPlaceholder測試:<br><a target="_blank" rel="noopener" href="https://jsonplaceholder.typicode.com/">JSONPlaceholder</a></p>
<p>使用quicktype將json檔案轉承我們要的形式:<br><a target="_blank" rel="noopener" href="https://app.quicktype.io/">quicktype</a></p>
<p>測試使用<a target="_blank" rel="noopener" href="https://jsonplaceholder.typicode.com/posts">posts</a>:</p>
<p><img data-src="/2021/9ca0/2021-12-29-14-19-09.png" alt="image2"></p>
<hr>
<h2 id="建立Model"><a href="#建立Model" class="headerlink" title="建立Model"></a>建立Model</h2><p>在models裡新增post_model:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:convert&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostModel</span> </span>&#123;</span><br><span class="line">  PostModel(&#123;</span><br><span class="line">    <span class="keyword">this</span>.userId,</span><br><span class="line">    <span class="keyword">this</span>.id,</span><br><span class="line">    <span class="keyword">this</span>.title,</span><br><span class="line">    <span class="keyword">this</span>.body,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">int</span> userId;</span><br><span class="line">  <span class="built_in">int</span> id;</span><br><span class="line">  <span class="built_in">String</span> title;</span><br><span class="line">  <span class="built_in">String</span> body;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> PostModel.fromJson(<span class="built_in">String</span> str) =&gt; PostModel.fromMap(json.decode(str));</span><br><span class="line"></span><br><span class="line">  <span class="built_in">String</span> toJson() =&gt; json.encode(toMap());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> PostModel.fromMap(<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; json) =&gt; PostModel(</span><br><span class="line">        userId: json[<span class="string">&quot;userId&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : json[<span class="string">&quot;userId&quot;</span>],</span><br><span class="line">        id: json[<span class="string">&quot;id&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : json[<span class="string">&quot;id&quot;</span>],</span><br><span class="line">        title: json[<span class="string">&quot;title&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : json[<span class="string">&quot;title&quot;</span>],</span><br><span class="line">        body: json[<span class="string">&quot;body&quot;</span>] == <span class="keyword">null</span> ? <span class="keyword">null</span> : json[<span class="string">&quot;body&quot;</span>],</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; toMap() =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;userId&quot;</span>: userId == <span class="keyword">null</span> ? <span class="keyword">null</span> : userId,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: id == <span class="keyword">null</span> ? <span class="keyword">null</span> : id,</span><br><span class="line">        <span class="string">&quot;title&quot;</span>: title == <span class="keyword">null</span> ? <span class="keyword">null</span> : title,</span><br><span class="line">        <span class="string">&quot;body&quot;</span>: body == <span class="keyword">null</span> ? <span class="keyword">null</span> : body,</span><br><span class="line">      &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>稍微修改</strong>(with null-safety):</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:convert&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostModel</span> </span>&#123;</span><br><span class="line">  PostModel(&#123;</span><br><span class="line">    <span class="keyword">this</span>.userId,</span><br><span class="line">    <span class="keyword">this</span>.id,</span><br><span class="line">    <span class="keyword">this</span>.title,</span><br><span class="line">    <span class="keyword">this</span>.body,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">int?</span> userId;</span><br><span class="line">  <span class="built_in">int?</span> id;</span><br><span class="line">  <span class="built_in">String?</span> title;</span><br><span class="line">  <span class="built_in">String?</span> body;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> PostModel.fromJson(<span class="built_in">String</span> str) =&gt; PostModel.fromMap(json.decode(str));</span><br><span class="line"></span><br><span class="line">  <span class="built_in">String</span> toJson() =&gt; json.encode(toMap());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> PostModel.fromMap(<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; json) =&gt; PostModel(</span><br><span class="line">        userId: json[<span class="string">&quot;userId&quot;</span>] ?? json[<span class="string">&quot;userId&quot;</span>],</span><br><span class="line">        id: json[<span class="string">&quot;id&quot;</span>] ?? json[<span class="string">&quot;id&quot;</span>],</span><br><span class="line">        title: json[<span class="string">&quot;title&quot;</span>] ?? json[<span class="string">&quot;title&quot;</span>],</span><br><span class="line">        body: json[<span class="string">&quot;body&quot;</span>] ?? json[<span class="string">&quot;body&quot;</span>],</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; toMap() =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;userId&quot;</span>: userId ?? userId,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: id ?? id,</span><br><span class="line">        <span class="string">&quot;title&quot;</span>: title ?? title,</span><br><span class="line">        <span class="string">&quot;body&quot;</span>: body ?? body,</span><br><span class="line">      &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>models.dart:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="string">&#x27;./post_model.dart&#x27;</span>;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="建立service"><a href="#建立service" class="headerlink" title="建立service"></a>建立service</h2><p>在services裡新增post_service:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:convert&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:developer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_restful/core/models/models.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:http/http.dart&#x27;</span> <span class="keyword">as</span> http;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostService</span> </span>&#123;</span><br><span class="line">  Future&lt;PostModel?&gt; findById(<span class="built_in">String</span> id) <span class="keyword">async</span> &#123;</span><br><span class="line">    PostModel post;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> headers = &#123;<span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>&#125;;</span><br><span class="line">      <span class="keyword">var</span> url = <span class="built_in">Uri</span>.parse(<span class="string">&#x27;https://jsonplaceholder.typicode.com/posts/<span class="subst">$id</span>&#x27;</span>);</span><br><span class="line">      <span class="keyword">final</span> response = <span class="keyword">await</span> http.<span class="keyword">get</span>(url, headers: headers);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (response.statusCode == <span class="number">200</span>) &#123;</span><br><span class="line">        post = PostModel.fromJson(response.body);</span><br><span class="line">        <span class="keyword">return</span> post;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        log(<span class="string">&#x27;請求失敗&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      log(<span class="string">&#x27;post fetch and set catch error&#x27;</span>, error: err);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Future&lt;<span class="built_in">List</span>&lt;PostModel&gt;&gt; findAll() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> headers = &#123;<span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>&#125;;</span><br><span class="line">      <span class="keyword">var</span> url = <span class="built_in">Uri</span>.parse(<span class="string">&#x27;https://jsonplaceholder.typicode.com/posts&#x27;</span>);</span><br><span class="line">      <span class="keyword">final</span> response = <span class="keyword">await</span> http.<span class="keyword">get</span>(url, headers: headers);</span><br><span class="line">      <span class="keyword">final</span> extractedData = json.decode(response.body);</span><br><span class="line">      <span class="keyword">final</span> <span class="built_in">List</span>&lt;PostModel&gt; loadedposts = [];</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> data <span class="keyword">in</span> extractedData) &#123;</span><br><span class="line">        loadedposts.add(PostModel(</span><br><span class="line">          id: data[<span class="string">&#x27;id&#x27;</span>],</span><br><span class="line">          userId: data[<span class="string">&#x27;userId&#x27;</span>],</span><br><span class="line">          title: data[<span class="string">&#x27;title&#x27;</span>],</span><br><span class="line">          body: data[<span class="string">&#x27;body&#x27;</span>],</span><br><span class="line">        ));</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> loadedposts;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      log(<span class="string">&#x27;posts fetch and set catch error&#x27;</span>, error: err);</span><br><span class="line">      <span class="keyword">return</span> [];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Future&lt;PostModel&gt; create(PostModel post, [<span class="built_in">String</span> token = <span class="string">&#x27;&#x27;</span>]) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> headers = &#123;</span><br><span class="line">        <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Authorization&#x27;</span>: token,</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">var</span> url = <span class="built_in">Uri</span>.parse(<span class="string">&#x27;https://jsonplaceholder.typicode.com/posts&#x27;</span>);</span><br><span class="line">      <span class="keyword">final</span> response = <span class="keyword">await</span> http.post(</span><br><span class="line">        url,</span><br><span class="line">        headers: headers,</span><br><span class="line">        body: json.encode(&#123;</span><br><span class="line">          <span class="string">&#x27;id&#x27;</span>: post.id,</span><br><span class="line">          <span class="string">&#x27;userId&#x27;</span>: post.userId,</span><br><span class="line">          <span class="string">&#x27;title&#x27;</span>: post.title,</span><br><span class="line">          <span class="string">&#x27;body&#x27;</span>: post.body,</span><br><span class="line">        &#125;),</span><br><span class="line">      );</span><br><span class="line">      log(response.body);</span><br><span class="line">      <span class="keyword">return</span> PostModel.fromJson(response.body);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      log(<span class="string">&#x27;Add error, &#x27;</span>, error: err);</span><br><span class="line">      <span class="keyword">throw</span> Exception(err);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Future&lt;PostModel&gt; delete(<span class="built_in">String</span> postId, [<span class="built_in">String</span> token = <span class="string">&#x27;&#x27;</span>]) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> headers = &#123;</span><br><span class="line">        <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Authorization&#x27;</span>: token,</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">var</span> url = <span class="built_in">Uri</span>.parse(<span class="string">&#x27;https://jsonplaceholder.typicode.com/posts/<span class="subst">$postId</span>&#x27;</span>);</span><br><span class="line">      <span class="keyword">final</span> response = <span class="keyword">await</span> http.delete(</span><br><span class="line">        url,</span><br><span class="line">        headers: headers,</span><br><span class="line">      );</span><br><span class="line">      log(response.body);</span><br><span class="line">      <span class="keyword">if</span> (response.statusCode == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> PostModel.fromJson(response.body);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> Exception(<span class="string">&#x27;Failed to delete post&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      log(<span class="string">&#x27;Delete error, &#x27;</span>, error: err);</span><br><span class="line">      <span class="keyword">throw</span> Exception(err);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Future&lt;PostModel&gt; edit(<span class="built_in">String</span> postId, PostModel post,</span><br><span class="line">      [<span class="built_in">String</span> token = <span class="string">&#x27;&#x27;</span>]) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> headers = &#123;</span><br><span class="line">        <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/json; charset=UTF-8&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Authorization&#x27;</span>: token,</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">var</span> url = <span class="built_in">Uri</span>.parse(<span class="string">&#x27;https://jsonplaceholder.typicode.com/posts/<span class="subst">$postId</span>&#x27;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">final</span> response = <span class="keyword">await</span> http.put(</span><br><span class="line">        url,</span><br><span class="line">        headers: headers,</span><br><span class="line">        body: json.encode(&#123;</span><br><span class="line">          <span class="string">&#x27;id&#x27;</span>: post.id,</span><br><span class="line">          <span class="string">&#x27;userId&#x27;</span>: post.userId,</span><br><span class="line">          <span class="string">&#x27;title&#x27;</span>: post.title,</span><br><span class="line">          <span class="string">&#x27;body&#x27;</span>: post.body,</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// body: post.toJson()</span></span><br><span class="line">      );</span><br><span class="line">      log(response.body);</span><br><span class="line">      <span class="keyword">if</span> (response.statusCode == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> PostModel.fromJson(response.body);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> Exception(<span class="string">&#x27;Failed to edit post&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      log(<span class="string">&#x27;Edit error, &#x27;</span>, error: err);</span><br><span class="line">      <span class="keyword">throw</span> Exception(err);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>services.dart:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="string">&#x27;./post_service.dart&#x27;</span>;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="UI"><a href="#UI" class="headerlink" title="UI"></a>UI</h2><p>home_screen.dart:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_restful/core/models/models.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_restful/core/services/post_service.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_restful/ui/post_detail_screen.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeScreen</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> HomeScreen(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _HomeScreenState createState() =&gt; _HomeScreenState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_HomeScreenState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">HomeScreen</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> _formKey = GlobalKey&lt;FormState&gt;();</span><br><span class="line">  <span class="keyword">final</span> TextEditingController _titleController = TextEditingController();</span><br><span class="line">  <span class="keyword">final</span> TextEditingController _contentController = TextEditingController();</span><br><span class="line"></span><br><span class="line">  PostService post = PostService();</span><br><span class="line">  PostModel model = PostModel();</span><br><span class="line">  <span class="built_in">List</span>&lt;PostModel&gt; _posts = [];</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement initState</span></span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    post.findAll().then((value) &#123;</span><br><span class="line">      setState(() &#123;</span><br><span class="line">        _posts = value;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      body: ListView.builder(</span><br><span class="line">        itemCount: _posts.length,</span><br><span class="line">        itemBuilder: (context, index) &#123;</span><br><span class="line">          PostModel _post = _posts[index];</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> ListTile(</span><br><span class="line">            title: Text(_post.title ?? <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">            dense: <span class="keyword">true</span>,</span><br><span class="line">            onTap: () &#123;</span><br><span class="line">              Navigator.push(</span><br><span class="line">                  context,</span><br><span class="line">                  MaterialPageRoute(</span><br><span class="line">                      builder: (context) =&gt; PostDetailScreen(</span><br><span class="line">                            post: _post,</span><br><span class="line">                          )));</span><br><span class="line">            &#125;,</span><br><span class="line">            trailing: Wrap(</span><br><span class="line">              spacing: <span class="number">12</span>, <span class="comment">// space between two icons</span></span><br><span class="line">              children: &lt;Widget&gt;[</span><br><span class="line">                IconButton(</span><br><span class="line">                  onPressed: () &#123;</span><br><span class="line">                    post.delete(index.toString());</span><br><span class="line">                    setState(() &#123;</span><br><span class="line">                      _posts.removeAt(index);</span><br><span class="line">                    &#125;);</span><br><span class="line">                  &#125;,</span><br><span class="line">                  icon: <span class="keyword">const</span> Icon(Icons.delete),</span><br><span class="line">                ),</span><br><span class="line">                IconButton(</span><br><span class="line">                  onPressed: () &#123;</span><br><span class="line">                    showDialog(</span><br><span class="line">                        context: context,</span><br><span class="line">                        builder: (BuildContext context) &#123;</span><br><span class="line">                          <span class="keyword">return</span> AlertDialog(</span><br><span class="line">                            content: Stack(</span><br><span class="line">                              clipBehavior: Clip.none,</span><br><span class="line">                              children: &lt;Widget&gt;[</span><br><span class="line">                                Positioned(</span><br><span class="line">                                  right: <span class="number">-40.0</span>,</span><br><span class="line">                                  top: <span class="number">-40.0</span>,</span><br><span class="line">                                  child: InkResponse(</span><br><span class="line">                                    onTap: () &#123;</span><br><span class="line">                                      Navigator.of(context).pop();</span><br><span class="line">                                    &#125;,</span><br><span class="line">                                    child: <span class="keyword">const</span> CircleAvatar(</span><br><span class="line">                                      child: Icon(Icons.close),</span><br><span class="line">                                      backgroundColor: Colors.red,</span><br><span class="line">                                    ),</span><br><span class="line">                                  ),</span><br><span class="line">                                ),</span><br><span class="line">                                Form(</span><br><span class="line">                                  key: _formKey,</span><br><span class="line">                                  child: Column(</span><br><span class="line">                                    mainAxisSize: MainAxisSize.min,</span><br><span class="line">                                    children: &lt;Widget&gt;[</span><br><span class="line">                                      <span class="keyword">const</span> Text(<span class="string">&#x27;Edit Post&#x27;</span>),</span><br><span class="line">                                      Padding(</span><br><span class="line">                                        padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">8.0</span>),</span><br><span class="line">                                        child: TextFormField(</span><br><span class="line">                                          decoration: <span class="keyword">const</span> InputDecoration(</span><br><span class="line">                                            labelText: <span class="string">&quot;title&quot;</span>,</span><br><span class="line">                                          ),</span><br><span class="line">                                          initialValue: _posts[index].title,</span><br><span class="line">                                          onSaved: (value) &#123;</span><br><span class="line">                                            model.title = value;</span><br><span class="line">                                          &#125;,</span><br><span class="line">                                        ),</span><br><span class="line">                                      ),</span><br><span class="line">                                      Padding(</span><br><span class="line">                                        padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">8.0</span>),</span><br><span class="line">                                        child: TextFormField(</span><br><span class="line">                                          decoration: <span class="keyword">const</span> InputDecoration(</span><br><span class="line">                                            labelText: <span class="string">&quot;content&quot;</span>,</span><br><span class="line">                                          ),</span><br><span class="line">                                          initialValue: _posts[index].body,</span><br><span class="line">                                          onSaved: (value) &#123;</span><br><span class="line">                                            model.body = value;</span><br><span class="line">                                          &#125;,</span><br><span class="line">                                        ),</span><br><span class="line">                                      ),</span><br><span class="line">                                      Padding(</span><br><span class="line">                                        padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">8.0</span>),</span><br><span class="line">                                        child: ElevatedButton(</span><br><span class="line">                                          child: <span class="keyword">const</span> Text(<span class="string">&quot;Edit&quot;</span>),</span><br><span class="line">                                          onPressed: () &#123;</span><br><span class="line">                                            <span class="keyword">if</span> (_formKey.currentState!</span><br><span class="line">                                                .validate()) &#123;</span><br><span class="line">                                              _formKey.currentState!.save();</span><br><span class="line">                                              model.userId = <span class="number">1</span>;</span><br><span class="line">                                              model.id = _posts[index].id;</span><br><span class="line">                                              post</span><br><span class="line">                                                  .edit(</span><br><span class="line">                                                      _posts[index]</span><br><span class="line">                                                          .id</span><br><span class="line">                                                          .toString(),</span><br><span class="line">                                                      model)</span><br><span class="line">                                                  .then(</span><br><span class="line">                                                (value) &#123;</span><br><span class="line">                                                  setState(() &#123;</span><br><span class="line">                                                    _posts[index] = value;</span><br><span class="line">                                                  &#125;);</span><br><span class="line">                                                &#125;,</span><br><span class="line">                                              );</span><br><span class="line">                                              Navigator.of(context).pop();</span><br><span class="line">                                            &#125;</span><br><span class="line">                                          &#125;,</span><br><span class="line">                                        ),</span><br><span class="line">                                      )</span><br><span class="line">                                    ],</span><br><span class="line">                                  ),</span><br><span class="line">                                ),</span><br><span class="line">                              ],</span><br><span class="line">                            ),</span><br><span class="line">                          );</span><br><span class="line">                        &#125;);</span><br><span class="line">                  &#125;,</span><br><span class="line">                  icon: <span class="keyword">const</span> Icon(Icons.edit),</span><br><span class="line">                ),</span><br><span class="line">              ],</span><br><span class="line">            ),</span><br><span class="line">          );</span><br><span class="line">        &#125;,</span><br><span class="line">      ),</span><br><span class="line">      floatingActionButton: FloatingActionButton(</span><br><span class="line">        child: <span class="keyword">const</span> Icon(Icons.add),</span><br><span class="line">        onPressed: () &#123;</span><br><span class="line">          showDialog(</span><br><span class="line">              context: context,</span><br><span class="line">              builder: (BuildContext context) &#123;</span><br><span class="line">                <span class="keyword">return</span> AlertDialog(</span><br><span class="line">                  content: Stack(</span><br><span class="line">                    clipBehavior: Clip.none,</span><br><span class="line">                    children: &lt;Widget&gt;[</span><br><span class="line">                      Positioned(</span><br><span class="line">                        right: <span class="number">-40.0</span>,</span><br><span class="line">                        top: <span class="number">-40.0</span>,</span><br><span class="line">                        child: InkResponse(</span><br><span class="line">                          onTap: () &#123;</span><br><span class="line">                            Navigator.of(context).pop();</span><br><span class="line">                          &#125;,</span><br><span class="line">                          child: <span class="keyword">const</span> CircleAvatar(</span><br><span class="line">                            child: Icon(Icons.close),</span><br><span class="line">                            backgroundColor: Colors.red,</span><br><span class="line">                          ),</span><br><span class="line">                        ),</span><br><span class="line">                      ),</span><br><span class="line">                      Form(</span><br><span class="line">                        key: _formKey,</span><br><span class="line">                        child: Column(</span><br><span class="line">                          mainAxisSize: MainAxisSize.min,</span><br><span class="line">                          children: &lt;Widget&gt;[</span><br><span class="line">                            <span class="keyword">const</span> Text(<span class="string">&#x27;Add Post&#x27;</span>),</span><br><span class="line">                            Padding(</span><br><span class="line">                              padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">8.0</span>),</span><br><span class="line">                              child: TextFormField(</span><br><span class="line">                                controller: _titleController,</span><br><span class="line">                                decoration: <span class="keyword">const</span> InputDecoration(</span><br><span class="line">                                  labelText: <span class="string">&quot;title&quot;</span>,</span><br><span class="line">                                ),</span><br><span class="line">                                onSaved: (value) &#123;</span><br><span class="line">                                  model.title = value;</span><br><span class="line">                                &#125;,</span><br><span class="line">                              ),</span><br><span class="line">                            ),</span><br><span class="line">                            Padding(</span><br><span class="line">                              padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">8.0</span>),</span><br><span class="line">                              child: TextFormField(</span><br><span class="line">                                controller: _contentController,</span><br><span class="line">                                decoration: <span class="keyword">const</span> InputDecoration(</span><br><span class="line">                                  labelText: <span class="string">&quot;content&quot;</span>,</span><br><span class="line">                                ),</span><br><span class="line">                                onSaved: (value) &#123;</span><br><span class="line">                                  model.body = value;</span><br><span class="line">                                &#125;,</span><br><span class="line">                              ),</span><br><span class="line">                            ),</span><br><span class="line">                            Padding(</span><br><span class="line">                              padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">8.0</span>),</span><br><span class="line">                              child: ElevatedButton(</span><br><span class="line">                                child: <span class="keyword">const</span> Text(<span class="string">&quot;Add&quot;</span>),</span><br><span class="line">                                onPressed: () &#123;</span><br><span class="line">                                  <span class="keyword">if</span> (_formKey.currentState!.validate()) &#123;</span><br><span class="line">                                    _formKey.currentState!.save();</span><br><span class="line">                                    model.userId = <span class="number">1</span>;</span><br><span class="line">                                    post.create(model).then(</span><br><span class="line">                                      (value) &#123;</span><br><span class="line">                                        setState(() &#123;</span><br><span class="line">                                          _posts.add(value);</span><br><span class="line">                                        &#125;);</span><br><span class="line">                                      &#125;,</span><br><span class="line">                                    );</span><br><span class="line">                                    Navigator.of(context).pop();</span><br><span class="line">                                  &#125;</span><br><span class="line">                                &#125;,</span><br><span class="line">                              ),</span><br><span class="line">                            )</span><br><span class="line">                          ],</span><br><span class="line">                        ),</span><br><span class="line">                      ),</span><br><span class="line">                    ],</span><br><span class="line">                  ),</span><br><span class="line">                );</span><br><span class="line">              &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>post_detail_screen.dart:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_restful/core/models/models.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostDetailScreen</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> PostModel post;</span><br><span class="line">  <span class="keyword">const</span> PostDetailScreen(&#123;</span><br><span class="line">    Key? key,</span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">this</span>.post,</span><br><span class="line">  &#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _PostDetailScreenState createState() =&gt; _PostDetailScreenState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_PostDetailScreenState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">PostDetailScreen</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(widget.post.title ?? <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">      ),</span><br><span class="line">      body: Column(</span><br><span class="line">        children: [</span><br><span class="line">          Text(widget.post.body ?? <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<p>main.dart:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;ui/home_screen.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  runApp(<span class="keyword">const</span> MyApp());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> MyApp(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// This widget is the root of your application.</span></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      title: <span class="string">&#x27;Flutter Demo&#x27;</span>,</span><br><span class="line">      theme: ThemeData(</span><br><span class="line">        primarySwatch: Colors.blue,</span><br><span class="line">      ),</span><br><span class="line">      home: <span class="keyword">const</span> HomeScreen(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h2><p><img data-src="/2021/9ca0/app-test.gif" alt="test restful api gif"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-tw,en,default">
    <link itemprop="mainEntityOfPage" href="https://www.fufunote.com/2021/dcc1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="FufuShih">
      <meta itemprop="description" content="裡是我紀錄、思考與分享的Blog，我會將一些在日常上的應用以及一些日常上常會遇到的問題給記錄下來。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="阿甫筆記——紀錄、思考與分享">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/dcc1/" class="post-title-link" itemprop="url">Flutter Widget中的Key</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-12-26 15:48:52" itemprop="dateCreated datePublished" datetime="2021-12-26T15:48:52+08:00">2021-12-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-05-03 19:25:26" itemprop="dateModified" datetime="2022-05-03T19:25:26+08:00">2022-05-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/flutter/" itemprop="url" rel="index"><span itemprop="name">flutter</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2021/dcc1/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/dcc1/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>3 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Flutter-Widget中的Key"><a href="#Flutter-Widget中的Key" class="headerlink" title="Flutter Widget中的Key"></a>Flutter Widget中的Key</h1><p>Flutter的Widget Tree會有結構相對應的Element Tree，若希望Widget Tree的node位置改變後，Element Tree也跟著調整對應的節點位置，就要使用key</p>
<h2 id="樹的生成和刷新"><a href="#樹的生成和刷新" class="headerlink" title="樹的生成和刷新"></a>樹的生成和刷新</h2><p>在Flutter應用第一次啟動的時候，attachRootWidget()生成了三棵樹(Widget Tree、Render Tree、Element Tree)</p>
<p><img data-src="/2021/dcc1/2021-12-13-10-08-39.png"></p>
<p><img data-src="/2021/dcc1/2022-05-03-19-25-02.png"></p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> runApp(Widget app) &#123;</span><br><span class="line">WidgetsFlutterBinding.ensureInitialized()</span><br><span class="line">..attachRootWidget(app)</span><br><span class="line">..scheduleWarmUpFrame();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在用戶點擊按鈕時，藉由setState()設置相關element node狀態為dirty, 使他在下一個vsync信號來時觸發widget tree的刷新</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">switchWidget() &#123;</span><br><span class="line">    widgets.insert(<span class="number">0</span>, widgets.removeAt(<span class="number">1</span>));</span><br><span class="line">    setState(() &#123;&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">@protected</span></span><br><span class="line"><span class="keyword">void</span> setState(VoidCallback fn) &#123;</span><br><span class="line">......</span><br><span class="line">_element.markNeedsBuild();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="element的生成"><a href="#element的生成" class="headerlink" title="element的生成"></a>element的生成</h2><ul>
<li>StatelessWidget element</li>
</ul>
<p>刷新過程中，StatelessWidget 會生成 StatelessElement</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">StatelessWidget</span> <span class="keyword">extends</span> <span class="title">Widget</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// <span class="markdown">Creates a [StatelessElement] to manage this widget&#x27;s location in the tree.</span></span></span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    StatelessElement createElement() =&gt; StatelessElement(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure>

<p>執行update時，rebuild()最終調用build()來直接重建一個Widget</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// StatelessElement，僅持有一個對Widget的引用，沒有狀態信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="markdown">An [Element] that uses a [StatelessWidget] as its configuration.</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StatelessElement</span> <span class="keyword">extends</span> <span class="title">ComponentElement</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Creates an element that uses the given widget as its configuration.</span></span><br><span class="line">    StatelessElement(StatelessWidget widget) : <span class="keyword">super</span>(widget);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    StatelessWidget <span class="keyword">get</span> widget =&gt; <span class="keyword">super</span>.widget;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    Widget build() =&gt; widget.build(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="keyword">void</span> update(StatelessWidget newWidget) &#123;</span><br><span class="line">        <span class="keyword">super</span>.update(newWidget);</span><br><span class="line">        <span class="keyword">assert</span>(widget == newWidget);</span><br><span class="line">        _dirty = <span class="keyword">true</span>;</span><br><span class="line">        rebuild();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<ul>
<li>StatefulWidget element</li>
</ul>
<p>刷新時，StatefulWidget會生成StatefulElement，這個Element除了有一個widget引用，還有一個State的引用，新建element的時候保存在_state中</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StatefulElement</span> <span class="keyword">extends</span> <span class="title">ComponentElement</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// <span class="markdown">Creates an element that uses the given widget as its configuration.</span></span></span><br><span class="line">    StatefulElement(StatefulWidget widget)</span><br><span class="line">        : _state = widget.createState(),</span><br></pre></td></tr></table></figure>

<p>當使用者觸發了element tree的刷新(ex.點擊按鈕)後，調用StatefulElement.update進行更新</p>
<blockquote>
<p>StatefulElement此時僅更新了widget的引用，<strong>沒有更新state</strong></p>
<p>因此，Element.rebuid最終會調用到我們定義的_StatefulContainerState.build中時，color還是<strong>之前的值</strong>，並沒有變化。</p>
<p>因為**_state沒有更新**，還是StatefulElement構造時使用的那個</p>
</blockquote>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">void</span> update(StatefulWidget newWidget) &#123;</span><br><span class="line">    ......</span><br><span class="line">    _state._widget = widget;</span><br></pre></td></tr></table></figure>

<h2 id="使用-Key-標記-Element"><a href="#使用-Key-標記-Element" class="headerlink" title="使用 Key 標記 Element"></a>使用 Key 標記 Element</h2><p>Flutter提出解決StatefulElement如何更新state的方案，就是使用Key標記Element。發現Key不相同時重新刷新Element</p>
<p>Element Tree 觸發更新過程:</p>
<ol>
<li>從根結點開始，Element.updateChild</li>
<li>深度遍歷到Row節點，child是StatefulContainer</li>
<li>判斷Widget.canUpdate(child.widget, newWidget)是true，可以執行更新</li>
</ol>
<blockquote>
<p>這裡child.widget是變化之前的StatefulContainer，newWidget是新的StatefulContainer；</p>
<p>由於上一步判斷可以更新，因此執行child.update(newWidget);也就是StatefulElement.update</p>
<p>StatefulElement.update的時候，僅更新了widget的引用，沒有更新state，導致顏色沒有變化。</p>
</blockquote>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">void</span> update(StatefulWidget newWidget) &#123;</span><br><span class="line">    ......</span><br><span class="line">    _state._widget = widget;</span><br></pre></td></tr></table></figure>

<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 關鍵點在Widget.canUpdate需要返回 false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Flutter設計人員設計了這個方法：當我們給 StatefulContainer設置 Key 時，Widget.canUpdate 返回 false。 </span></span><br><span class="line"><span class="comment">// 原有的Element會被暫時deactive，在需要時重新mount到樹上。從而保證 StatefulWidget 狀態可更新，而且狀態不丟失</span></span><br><span class="line"><span class="keyword">static</span> <span class="built_in">bool</span> canUpdate(Widget oldWidget, Widget newWidget) &#123;</span><br><span class="line">    <span class="keyword">return</span> oldWidget.runtimeType == newWidget.runtimeType</span><br><span class="line">    &amp;&amp; oldWidget.key == newWidget.key;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>從圖中可以看到，Widget和State狀態對應產生了問題。Key就是為了解決圖中widget更新而state沒有更新導致的問題而出現的</p>
<p><img data-src="/2021/dcc1/2021-12-27-00-58-49.png" alt="tree"></p>
<p>另一種場景是使用了key，但是導致State被重新創建從而丟失State信息。這就是Key的作用域的問題。對應的解決方案就是GloableKey</p>
<hr>
<h1 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h1><p><a target="_blank" rel="noopener" href="https://codertw.com/%E7%A8%8B%E5%BC%8F%E8%AA%9E%E8%A8%80/741171/#outline__2_1">Flutter學習筆記：Key的作用</a><br><a target="_blank" rel="noopener" href="https://openhome.cc/Gossip/Flutter/Key2.html">Flutter學習筆記：Key的作用2</a><br><a target="_blank" rel="noopener" href="https://openhome.cc/Gossip/Flutter/Key.html">Widget 的 Key</a><br><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=kn0EOS-ZiIc">When to Use Keys</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="FufuShih"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">FufuShih</p>
  <div class="site-description" itemprop="description">裡是我紀錄、思考與分享的Blog，我會將一些在日常上的應用以及一些日常上常會遇到的問題給記錄下來。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">23</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/fufuShih" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;fufuShih" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zx8714245@gmail.com" title="E-Mail → mailto:zx8714245@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.kaggle.com/fufushih" title="Kaggle → https:&#x2F;&#x2F;www.kaggle.com&#x2F;fufushih" rel="noopener" target="_blank"><i class="fab fa-kaggle fa-fw"></i>Kaggle</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.linkedin.com/in/chen-fu-shih-a04537161/" title="Linkin → https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;chen-fu-shih-a04537161&#x2F;" rel="noopener" target="_blank"><i class="fab fa-linkedin-in fa-fw"></i>Linkin</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">FufuShih</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  




  
<script src="/js/local-search.js"></script>













    <div id="pjax">
  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://fufu.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>

    </div>
</body>
</html>
